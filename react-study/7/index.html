<!-- build time:Wed Nov 09 2022 11:12:10 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="永不陨落的星辰" href="https://www.yexingcheng.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="永不陨落的星辰" href="https://www.yexingcheng.com/atom.xml"><link rel="alternate" type="application/json" title="永不陨落的星辰" href="https://www.yexingcheng.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="react"><link rel="canonical" href="https://www.yexingcheng.com/react-study/7/"><title>React学习第七天 - react学习 | 永不陨落的星辰 = 永不陨落的星辰</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">React学习第七天</h1><div class="meta"><span class="item" title="创建时间：2022-08-07 00:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-08-07T00:00:00+08:00">2022-08-07</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>25k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>23 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">永不陨落的星辰</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gipet8c1a2j20zk0m8kct.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giclgi503lj20zk0m8hdt.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gicliwyw55j20zk0m8hdt.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giclhnx9glj20zk0m8npd.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gicis081o9j20zk0m8dmr.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giclflwv2aj20zk0m84qp.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/react%E5%AD%A6%E4%B9%A0/" itemprop="item" rel="index" title="分类于 react学习"><span itemprop="name">react学习</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.yexingcheng.com/react-study/7/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="叶星辰"><meta itemprop="description" content=", 温柔正确的人总是难以生存，因为这个世界既不温柔 也不正确"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="永不陨落的星辰"></span><div class="body md" itemprop="articleBody"><h1 id="十七-hooks"><a class="anchor" href="#十七-hooks">#</a> 十七、hooks</h1><h2 id="171-为什么使用hooks"><a class="anchor" href="#171-为什么使用hooks">#</a> 17.1 为什么使用 hooks</h2><p>React 没有提供将可复用性行为 “附加” 到组件的途径（例如，把组件连接到 store）。如果你使用过 React 一段时间，你也许会熟悉一些解决此类问题的方案，比如 <span class="exturl" data-url="aHR0cHM6Ly9naXRlZS5jb20vbGluaz90YXJnZXQ9aHR0cHMlM0ElMkYlMkZ6aC1oYW5zLnJlYWN0anMub3JnJTJGZG9jcyUyRnJlbmRlci1wcm9wcy5odG1s">render props</span> 和 <span class="exturl" data-url="aHR0cHM6Ly9naXRlZS5jb20vbGluaz90YXJnZXQ9aHR0cHMlM0ElMkYlMkZ6aC1oYW5zLnJlYWN0anMub3JnJTJGZG9jcyUyRmhpZ2hlci1vcmRlci1jb21wb25lbnRzLmh0bWw=">高阶组件</span>。</p><p><strong>Hook 使你在非 class 的情况下可以使用更多的 React 特性。</strong> 从概念上讲，React 组件一直更像是函数。而 Hook 则拥抱了函数，同时也没有牺牲 React 的精神原则。Hook 提供了问题的解决方案，无需学习复杂的函数式或响应式编程技术。</p><p><strong>react 18 版本以前 hooks</strong></p><ul><li><span class="exturl" data-url="aHR0cHM6Ly9yZWFjdC5kb2NzY2hpbmEub3JnL2RvY3MvaG9va3MtcmVmZXJlbmNlLmh0bWwjYmFzaWMtaG9va3M=">基础 Hook</span><ul><li><a target="_blank" rel="noopener" href="https://react.docschina.org/docs/hooks-reference.html#usestate"><code>useState</code></a></li><li><a target="_blank" rel="noopener" href="https://react.docschina.org/docs/hooks-reference.html#useeffect"><code>useEffect</code></a></li><li><a target="_blank" rel="noopener" href="https://react.docschina.org/docs/hooks-reference.html#usecontext"><code>useContext</code></a></li></ul></li><li><span class="exturl" data-url="aHR0cHM6Ly9yZWFjdC5kb2NzY2hpbmEub3JnL2RvY3MvaG9va3MtcmVmZXJlbmNlLmh0bWwjYWRkaXRpb25hbC1ob29rcw==">额外的 Hook</span><ul><li><a target="_blank" rel="noopener" href="https://react.docschina.org/docs/hooks-reference.html#usereducer"><code>useReducer</code></a></li><li><a target="_blank" rel="noopener" href="https://react.docschina.org/docs/hooks-reference.html#usecallback"><code>useCallback</code></a></li><li><a target="_blank" rel="noopener" href="https://react.docschina.org/docs/hooks-reference.html#usememo"><code>useMemo</code></a></li><li><a target="_blank" rel="noopener" href="https://react.docschina.org/docs/hooks-reference.html#useref"><code>useRef</code></a></li><li><a target="_blank" rel="noopener" href="https://react.docschina.org/docs/hooks-reference.html#useimperativehandle"><code>useImperativeHandle</code></a></li><li><a target="_blank" rel="noopener" href="https://react.docschina.org/docs/hooks-reference.html#uselayouteffect"><code>useLayoutEffect</code></a></li><li><code>useDebugValue</code></li></ul></li></ul><h2 id="172常见的hooks"><a class="anchor" href="#172常见的hooks">#</a> 17.2 常见的 hooks</h2><h3 id="1721-usestate"><a class="anchor" href="#1721-usestate">#</a> 17.2.1 useState</h3><p><code>src/index.js</code></p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// src/index.js</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom/client'</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">/</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./12_hooks/01_App_hooks_useState'</span> <span class="token comment">// hooks useState</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">const</span> root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">// 标签形式调用</span></pre></td></tr><tr><td data-num="11"></td><td><pre>root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>src/12_hooks/01_App_hooks_useState.jsx</code></p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// rsc</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// 函数式组件内不要使用 this</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// 如果想要 this 指向函数式组件，本身这个想法就是错误的</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token comment">// 定义了一个初始化状态 为 count</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token comment">// 定义了一个修改初始化状态的函数 为 setCount</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token comment">// 使用 useState 定义了初始化装 count 的值为 1</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> setName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'吴'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token keyword">function</span> <span class="token function">add100</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">100</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token keyword">const</span> <span class="token function-variable function">add1000</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1000</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token keyword">const</span> <span class="token function-variable function">add10000</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">prevCount</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token comment">// 函数写法</span></pre></td></tr><tr><td data-num="25"></td><td><pre>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>prevCount<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="26"></td><td><pre>      <span class="token keyword">return</span> prevCount <span class="token operator">+</span> <span class="token number">10000</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="31"></td><td><pre>      <span class="token punctuation">&#123;</span> count <span class="token punctuation">&#125;</span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="32"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></span></span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token comment">// 修改函数内部的值为 运算之后的结果</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>      <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">></span><span class="token plain-text">加1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="36"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></span></span></pre></td></tr><tr><td data-num="37"></td><td><pre>        <span class="token comment">// 修改函数内部的值为 运算之后的结果</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre>      <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">></span><span class="token plain-text">加10</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="40"></td><td><pre></pre></td></tr><tr><td data-num="41"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span> add100 <span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">加100</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="42"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span> add1000 <span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">加1000</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="43"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span> add10000 <span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">加10000</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="44"></td><td><pre>      <span class="token punctuation">&#123;</span> name <span class="token punctuation">&#125;</span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="45"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></span></span></pre></td></tr><tr><td data-num="46"></td><td><pre>        <span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">'吴大勋'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="47"></td><td><pre>      <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">></span><span class="token plain-text">修改name</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="49"></td><td><pre>  <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></pre></td></tr></table></figure><p><code>src/index.js</code></p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// src/index.js</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom/client'</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">/</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./12_hooks/02_App_hooks_useState_obj'</span> <span class="token comment">// hooks useState  object</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">const</span> root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">// 标签形式调用</span></pre></td></tr><tr><td data-num="11"></td><td><pre>root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>src/12_hooks/02_App_hooks_useState_obj.jsx</code></p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">const</span> <span class="token punctuation">[</span>obj<span class="token punctuation">,</span> setObj<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token literal-property property">w</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token literal-property property">h</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token keyword">const</span> <span class="token function-variable function">mouseMove</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment">// 鼠标移动，发现 w 和 h 的数据丢失，&#123;x: 1, y: 1&#125; 代替了原来的对象 obj </span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token comment">// setObj(&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment">//   x: event.clientX,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token comment">//   y: event.clientY</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token comment">// &#125;)</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token comment">//setObj (&#123; // 合并新数据到原来的 obj</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token comment">//   ...obj,</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token comment">//   x: event.clientX,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token comment">//   y: event.clientY</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token comment">// &#125;)</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token function">setObj</span><span class="token punctuation">(</span><span class="token parameter">prevObj</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>      <span class="token comment">// return &#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>      <span class="token comment">//   w: prevObj.w,</span></pre></td></tr><tr><td data-num="28"></td><td><pre>      <span class="token comment">//   h: prevObj.h,</span></pre></td></tr><tr><td data-num="29"></td><td><pre>      <span class="token comment">//   x: event.clientX,</span></pre></td></tr><tr><td data-num="30"></td><td><pre>      <span class="token comment">//   y: event.clientY</span></pre></td></tr><tr><td data-num="31"></td><td><pre>      <span class="token comment">// &#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>      <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> prevObj<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">x</span><span class="token operator">:</span> event<span class="token punctuation">.</span>clientX <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">y</span><span class="token operator">:</span> event<span class="token punctuation">.</span>clientY<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre>  <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">&#123;</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">'100vw'</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token string">'100vh'</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> onMouseMove <span class="token operator">=</span> <span class="token punctuation">&#123;</span> mouseMove <span class="token punctuation">&#125;</span><span class="token operator">></span></pre></td></tr><tr><td data-num="38"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">元素的宽为: </span><span class="token punctuation">&#123;</span> obj<span class="token punctuation">.</span>w <span class="token punctuation">&#125;</span><span class="token plain-text">，元素的高为： </span><span class="token punctuation">&#123;</span> obj<span class="token punctuation">.</span>h <span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="39"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">元素的坐标点为： (</span><span class="token punctuation">&#123;</span> obj<span class="token punctuation">.</span>x <span class="token punctuation">&#125;</span><span class="token plain-text">,</span><span class="token punctuation">&#123;</span>  obj<span class="token punctuation">.</span>y<span class="token punctuation">&#125;</span><span class="token plain-text">)</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="41"></td><td><pre>  <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></pre></td></tr></table></figure><p><code>src/index.js</code></p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// src/index.js</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom/client'</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./12_hooks/03_App_hooks_useState_state'</span> <span class="token comment">//hooks useState  拆分对象状态</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">const</span> root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">// 标签形式调用</span></pre></td></tr><tr><td data-num="10"></td><td><pre>root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>src/12_hooks/03_App_hooks_useState_state.jsx</code></p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token comment">// 如果不需要修改状态，那么可以不写解构的第二个值</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">const</span> <span class="token punctuation">[</span> box <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">w</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token literal-property property">h</span><span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token keyword">const</span> <span class="token punctuation">[</span>position<span class="token punctuation">,</span> setPosition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token keyword">const</span> <span class="token function-variable function">mouseMove</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token literal-property property">x</span><span class="token operator">:</span> event<span class="token punctuation">.</span>clientX<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token literal-property property">y</span><span class="token operator">:</span> event<span class="token punctuation">.</span>clientY</pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">&#123;</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">'100vw'</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token string">'100vh'</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> onMouseMove <span class="token operator">=</span> <span class="token punctuation">&#123;</span> mouseMove <span class="token punctuation">&#125;</span><span class="token operator">></span></pre></td></tr><tr><td data-num="19"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">元素的宽为: </span><span class="token punctuation">&#123;</span> box<span class="token punctuation">.</span>w <span class="token punctuation">&#125;</span><span class="token plain-text">，元素的高为： </span><span class="token punctuation">&#123;</span> box<span class="token punctuation">.</span>h <span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="20"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">元素的坐标点为： (</span><span class="token punctuation">&#123;</span> position<span class="token punctuation">.</span>x <span class="token punctuation">&#125;</span><span class="token plain-text">,</span><span class="token punctuation">&#123;</span>  position<span class="token punctuation">.</span>y<span class="token punctuation">&#125;</span><span class="token plain-text">)</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><ul><li><p><strong>不要在循环，条件或嵌套函数中调用 Hook，</strong> 确保总是在你的 React 函数的最顶层以及任何 return 之前调用他们。</p></li><li><p>** 只在 React 函数中调用 Hook，** 不要在普通的 JavaScript 函数中调用 Hook。你可以：</p><ul><li>在 React 的函数组件中调用 Hook</li><li>在自定义 Hook 中调用其他 Hook</li></ul></li><li><p>如果遇到需要以对象的形式定义状态时，根据需求划分对象，因为修改状态使用的是替换</p></li></ul></blockquote><h3 id="1722-useeffect"><a class="anchor" href="#1722-useeffect">#</a> 17.2.2 useEffect</h3><p><code>src/index.js</code></p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// src/index.js</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom/client'</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./12_hooks/04_App_hooks_useEffect'</span> <span class="token comment">// hooks useEffect  </span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">const</span> root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">// 标签形式调用</span></pre></td></tr><tr><td data-num="11"></td><td><pre>root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token attr-name">root</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>root<span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>src/12_hooks/04_App_hooks_useEffect.jsx</code></p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">const</span> <span class="token punctuation">[</span>proList<span class="token punctuation">,</span> setProList<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token comment">// 数据请求 --- 函数式组件没有 生命周期钩子函数</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token comment">//useEffect 的第一个参数是一个回调函数 类似于类组件中的 componentDidMount 以及 componentDidUpdate</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token comment">//useEffect 内的代码会自动执行</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token comment">//useEffect 如果没有添加第二个依赖的参数，那么只要内部修改果状态，此部分代码就会一直执行</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token comment">// useEffect(() => &#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token comment">//   fetch('http://121.89.205.189:3001/api/pro/list').then(res => res.json()).then(res => &#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token comment">//     console.log (res.data) // 第一次打印 - componentDidMount</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token comment">//     setProList (res.data) // 发现上一句话一直在打印 - componentDidUpdate 且没有条件限制</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token comment">//   &#125;)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token comment">// &#125;)</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token comment">// 可以给 useEffect 添加第二个参数进行控制内部代码执行的次数</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token comment">// useEffect(() => &#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token comment">//   fetch('http://121.89.205.189:3001/api/pro/list').then(res => res.json()).then(res => &#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token comment">//     console.log(res.data) </span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token comment">//     setProList(res.data) </span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token comment">//   &#125;)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token comment">// &#125;, []) //useEffect 第二个参数为空数组，代表 useEffect 内部只会执行类似 componentDidMount 的操作</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  </pre></td></tr><tr><td data-num="26"></td><td><pre>  <span class="token comment">// 依赖值发生改变，再次触发代码执行，类似于 componentDidUpdate 中特定条件下请求数据</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://121.89.205.189:3001/api/pro/list'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="30"></td><td><pre>      <span class="token function">setProList</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 第二个参数写入值，代表只有当 count 的值发生改变时，才会再次触发 useEffect，再次执行</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre>  <span class="token comment">// 如何模拟 组件的销毁呢？</span></pre></td></tr><tr><td data-num="36"></td><td><pre>  <span class="token comment">// 在 useEffect 内部的回调函数中 返回一个函数</span></pre></td></tr><tr><td data-num="37"></td><td><pre>  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token comment">// 为防止内存泄漏，清除函数会在组件卸载前执行。</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token comment">// 另外，如果组件多次渲染（通常如此），则在执行下一个 effect 之前，上一个 effect 就已被清除。</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token comment">// 类似于类组件中的 componentWillUnmount</span></pre></td></tr><tr><td data-num="42"></td><td><pre>      <span class="token comment">// 取消订阅的操作，销毁定时器，计时器等操作</span></pre></td></tr><tr><td data-num="43"></td><td><pre>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'组件销毁了'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre>  <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="48"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></span></span></pre></td></tr><tr><td data-num="49"></td><td><pre>        <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="50"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">===</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>          props<span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token function">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="52"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">></span><span class="token plain-text">加1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"> </span><span class="token punctuation">&#123;</span> count <span class="token punctuation">&#125;</span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="54"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="55"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>          proList <span class="token operator">&amp;&amp;</span> proList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="57"></td><td><pre>            <span class="token operator">&lt;</span>li key <span class="token operator">=</span> <span class="token punctuation">&#123;</span> item<span class="token punctuation">.</span>proid <span class="token punctuation">&#125;</span><span class="token operator">></span> <span class="token punctuation">&#123;</span> item<span class="token punctuation">.</span>proname <span class="token punctuation">&#125;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="58"></td><td><pre>          <span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="59"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="60"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="61"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="62"></td><td><pre>  <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="64"></td><td><pre></pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><ol><li>useEffect () 是个副作用函数。</li><li>useEffect () 函数在每次组件重新渲染时，可再次被调用。</li><li>在开发环境中，开启了 React.StrictMode 模式，组件开始时被渲染两次。</li><li>useEffect () 通过返回函数来清理副作用。</li><li>useEffect () 通过传递第二个参数数组来提高渲染性能，或者说实现 watch 效果。</li></ol></blockquote><h3 id="1723-useref"><a class="anchor" href="#1723-useref">#</a> 17.2.3 useRef</h3><p>利用 <code>useRef</code> 就可以绕过 Capture Value 的特性。<strong>可以认为</strong> <code>ref</code> <strong>在所有 Render 过程中保持着唯一引用，因此所有对</strong> <code>ref</code> <strong>的赋值或取值，拿到的都只有一个最终状态</strong>，而不会在每个 Render 间存在隔离。</p><p><code>src/index.js</code></p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// src/index.js</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom/client'</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./12_hooks/05_App_hooks_useRef'</span> <span class="token comment">// hooks useRef  </span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">const</span> root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">// 标签形式调用</span></pre></td></tr><tr><td data-num="10"></td><td><pre>root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>src/12_hooks/05_App_hooks_useRef.jsx</code></p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useEffect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useRef <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">const</span> FunCom <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token operator">&lt;</span>div ref <span class="token operator">=</span> <span class="token punctuation">&#123;</span> ref <span class="token punctuation">&#125;</span><span class="token operator">></span>函数式组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Com</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  state <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'类组件'</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token function-variable function">testFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">'!!'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="18"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">类组件</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token keyword">const</span> btnRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 类组件中  React.createRef ()</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token keyword">const</span> comRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  <span class="token keyword">const</span> funRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>btnRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>comRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>funRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre>  <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="35"></td><td><pre>      &lt;button ref = <span class="token punctuation">&#123;</span> btnRef <span class="token punctuation">&#125;</span><span class="token plain-text">>按钮ref</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="36"></td><td><pre>      &lt;Com ref = <span class="token punctuation">&#123;</span> comRef <span class="token punctuation">&#125;</span><span class="token plain-text">/></span></pre></td></tr><tr><td data-num="37"></td><td><pre>      &lt;FunCom ref = <span class="token punctuation">&#123;</span> funRef <span class="token punctuation">&#125;</span><span class="token plain-text">/></span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="39"></td><td><pre>  <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="1724-usereducer"><a class="anchor" href="#1724-usereducer">#</a> 17.2.4 useReducer</h3><p>useReducer 践行了 Flux/Redux 思想。使用步骤：</p><p>1、创建初始值 initialState</p><p>2、创建所有操作 reducer (state, action);</p><p>3、传给 userReducer，得到读和写 API</p><p>4、调用写 ({type: ' 操作类型 '})</p><p>总的来说，useReducer 是 useState 的复杂版。</p><p><code>src/index.js</code></p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// src/index.js</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom/client'</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">/</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./12_hooks/06_App_hooks_useReducer'</span> <span class="token comment">// hooks useReducer  </span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">const</span> root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">// 标签形式调用</span></pre></td></tr><tr><td data-num="11"></td><td><pre>root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>src/12_hooks/06_App_hooks_useReducer.jsx</code></p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useEffect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useReducer <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// 1. 创建初始化状态</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token literal-property property">bannerList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token literal-property property">proList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">// 2. 创建所有操作 reducer (state, action)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">case</span> <span class="token string">'CHANGE_BANNER_LIST'</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token comment">// 返回一个新的状态 -- 当触发修改轮播图数据时，得到一个新的数据</span></pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token comment">// 如何保证得到一份新的数据  -- 推荐使用 对象的合并</span></pre></td></tr><tr><td data-num="15"></td><td><pre>      <span class="token comment">// return &#123; ...state, bannerList: action.payload &#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>      <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> state<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">bannerList</span><span class="token operator">:</span> action<span class="token punctuation">.</span>payload <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">case</span> <span class="token string">'CHANGE_PRO_LIST'</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">proList</span><span class="token operator">:</span> action<span class="token punctuation">.</span>payload <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">default</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>      <span class="token keyword">return</span> state</pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token comment">// 3. 传给 userReducer，得到读和写 API</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  <span class="token comment">//state 代表所有的数据</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token comment">//dispatch 可以触发 reducer 的改变</span></pre></td></tr><tr><td data-num="28"></td><td><pre>  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://121.89.205.189:3001/api/banner/list'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'CHANGE_BANNER_LIST'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token literal-property property">payload</span><span class="token operator">:</span> res<span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="35"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://121.89.205.189:3001/api/pro/list'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'CHANGE_PRO_LIST'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        <span class="token literal-property property">payload</span><span class="token operator">:</span> res<span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="41"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="44"></td><td><pre>  <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="46"></td><td><pre>       <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>          state<span class="token punctuation">.</span>bannerList <span class="token operator">&amp;&amp;</span> state<span class="token punctuation">.</span>bannerList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="48"></td><td><pre>            <span class="token operator">&lt;</span>img key <span class="token operator">=</span> <span class="token punctuation">&#123;</span> item<span class="token punctuation">.</span>bannerid <span class="token punctuation">&#125;</span>  alt<span class="token operator">=</span><span class="token punctuation">&#123;</span> item<span class="token punctuation">.</span>alt <span class="token punctuation">&#125;</span> src <span class="token operator">=</span> <span class="token punctuation">&#123;</span> item<span class="token punctuation">.</span>img <span class="token punctuation">&#125;</span> style<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>swig￼<span class="token number">0</span><span class="token operator">--</span><span class="token operator">></span><span class="token operator">/</span><span class="token operator">></span></pre></td></tr><tr><td data-num="49"></td><td><pre>          <span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="50"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="53"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>          state<span class="token punctuation">.</span>proList <span class="token operator">&amp;&amp;</span> state<span class="token punctuation">.</span>proList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="55"></td><td><pre>            <span class="token operator">&lt;</span>li key <span class="token operator">=</span> <span class="token punctuation">&#123;</span> item<span class="token punctuation">.</span>proid <span class="token punctuation">&#125;</span><span class="token operator">></span> <span class="token punctuation">&#123;</span> item<span class="token punctuation">.</span>proname <span class="token punctuation">&#125;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="56"></td><td><pre>          <span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="57"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="58"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="59"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="60"></td><td><pre>  <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre></pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>如果遇到多个组件需要共享状态时，单纯 useReducer 就显得无能为力</p></blockquote><h3 id="1725-usecontext"><a class="anchor" href="#1725-usecontext">#</a> 17.2.5 useContext</h3><p>1、使用 C = createContext (initial) 创建上下文</p><p>2、使用 &lt;C.Provider&gt; 圈定作用域</p><p>3、在作用域内使用 useContext (C) 来使用上下文</p><p><code>src/index.js</code></p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// src/index.js</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom/client'</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./12_hooks/07_App_hooks_useContext'</span> <span class="token comment">// hooks useContext  </span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">const</span> root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">// 标签形式调用</span></pre></td></tr><tr><td data-num="10"></td><td><pre>root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>src/12_hooks/07_App_hooks_useContext.jsx</code></p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useContext <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">const</span> LangContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">const</span> ColorContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">Second</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token keyword">const</span> lang <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>LangContext<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">const</span> color <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>ColorContext<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">Second</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token punctuation">&#123;</span> lang <span class="token punctuation">&#125;</span><span class="token plain-text"> - </span><span class="token punctuation">&#123;</span> color <span class="token punctuation">&#125;</span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">First</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="19"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">first</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="20"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Second</span></span> <span class="token punctuation">/></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="27"></td><td><pre>      &lt;LangContext.Provider value = "中文"></pre></td></tr><tr><td data-num="28"></td><td><pre>        &lt;ColorContext.Provider value = "red"></pre></td></tr><tr><td data-num="29"></td><td><pre>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">First</span></span> <span class="token punctuation">/></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ColorContext.Provider</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="31"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">LangContext.Provider</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="32"></td><td><pre>      </pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="34"></td><td><pre>  <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>使用 useReducer 和 useContext 实现轻型 Redux, 可以让组件间共享状态</strong></p><p>步骤：</p><p>1、将数据集中在一个 store 对象</p><p>2、将所有操作集中在 reducer</p><p>3、创建一个 Context</p><p>4、创建对数据的读取 API</p><p>5、将第四步的内容放到第三步的 Context</p><p>6、用 Context.Provider 将 Context 提供给所有组件</p><p>7、各个组件用 useContext 获取读写 API</p><p><code>src/index.js</code></p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// src/index.js</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom/client'</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./12_hooks/08_App_hooks_redux'</span> <span class="token comment">// hooks useContext useReducer redux</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">const</span> root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">// 标签形式调用</span></pre></td></tr><tr><td data-num="10"></td><td><pre>root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>src/09-App-redux.jsx</code></p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useContext <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useEffect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useReducer <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">const</span> MyContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">const</span> intitalState <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token literal-property property">userName</span><span class="token operator">:</span> <span class="token string">'吴大勋'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token literal-property property">proList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">case</span> <span class="token string">'CHANGE_USER_NAME'</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">userName</span><span class="token operator">:</span> action<span class="token punctuation">.</span>payload <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">case</span> <span class="token string">'CHANGE_COUNT'</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num="18"></td><td><pre>      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">count</span><span class="token operator">:</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">case</span> <span class="token string">'CHANGE_PRO_LIST'</span><span class="token operator">:</span> </pre></td></tr><tr><td data-num="20"></td><td><pre>      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">proList</span><span class="token operator">:</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">default</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>      <span class="token keyword">return</span> state</pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">Home</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>  <span class="token comment">// const [state, dispatch] = useReducer(reducer, intitalState)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> state<span class="token punctuation">,</span> dispatch <span class="token punctuation">&#125;</span>  <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>MyContext<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token comment">// 不要直接在回调函数上使用 async</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">const</span> <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>      <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span>  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://121.89.205.189:3001/api/pro/list'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre>      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'CHANGE_PRO_LIST'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token literal-property property">payload</span><span class="token operator">:</span> res<span class="token punctuation">.</span>data</pre></td></tr><tr><td data-num="36"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>dispatch<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre>  <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="43"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">Home</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="44"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="45"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>          state<span class="token punctuation">.</span>proList <span class="token operator">&amp;&amp;</span> state<span class="token punctuation">.</span>proList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="47"></td><td><pre>            <span class="token operator">&lt;</span>li key <span class="token operator">=</span> <span class="token punctuation">&#123;</span> item<span class="token punctuation">.</span>proid <span class="token punctuation">&#125;</span><span class="token operator">></span> <span class="token punctuation">&#123;</span> item<span class="token punctuation">.</span>proname <span class="token punctuation">&#125;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="48"></td><td><pre>          <span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="49"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="50"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="51"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="52"></td><td><pre>  <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">List</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>  <span class="token comment">// const [state, dispatch] = useReducer(reducer, intitalState)</span></pre></td></tr><tr><td data-num="56"></td><td><pre>  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> state <span class="token punctuation">&#125;</span>  <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>MyContext<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="57"></td><td><pre>  <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="58"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="59"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">List</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="60"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="61"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>          state<span class="token punctuation">.</span>proList <span class="token operator">&amp;&amp;</span> state<span class="token punctuation">.</span>proList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="63"></td><td><pre>            <span class="token operator">&lt;</span>li key <span class="token operator">=</span> <span class="token punctuation">&#123;</span> item<span class="token punctuation">.</span>proid <span class="token punctuation">&#125;</span><span class="token operator">></span> <span class="token punctuation">&#123;</span> item<span class="token punctuation">.</span>proname <span class="token punctuation">&#125;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="64"></td><td><pre>          <span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="65"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="66"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="67"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="68"></td><td><pre>  <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="69"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="70"></td><td><pre></pre></td></tr><tr><td data-num="71"></td><td><pre><span class="token comment">// Home 组件  以及 List 组件共享 列表数据</span></pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="73"></td><td><pre>  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> intitalState<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="74"></td><td><pre>  <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="75"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="76"></td><td><pre>      &lt;MyContext.Provider value = <span class="token punctuation">&#123;</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="77"></td><td><pre>        state<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="78"></td><td><pre>        dispatch</pre></td></tr><tr><td data-num="79"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token plain-text"> ></span></pre></td></tr><tr><td data-num="80"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Home</span></span> <span class="token punctuation">/></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="81"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">List</span></span> <span class="token punctuation">/></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="82"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">MyContext.Provider</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="83"></td><td><pre>      </pre></td></tr><tr><td data-num="84"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="85"></td><td><pre>  <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="86"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="87"></td><td><pre></pre></td></tr><tr><td data-num="88"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>useContext + useReducer 可以实现轻型 redux，但是不适合应用于多模块管理的大型项目</p></blockquote><h3 id="1726-usememo"><a class="anchor" href="#1726-usememo">#</a> 17.2.6 useMemo</h3><h3 id="1727-usecallback"><a class="anchor" href="#1727-usecallback">#</a> 17.2.7 useCallback</h3><p><code>src/index.js</code></p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// src/index.js</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom/client'</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">/</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./12_hooks/09_App_hooks_useCallback_useMemo'</span> <span class="token comment">//hooks useCallback useMemo 提升性能以及计算属性</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">const</span> root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">// 标签形式调用</span></pre></td></tr><tr><td data-num="11"></td><td><pre>root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>src/12_hooks/09_App_hooks_useCallback_useMemo.jsx</code></p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useMemo <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useCallback <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// const Child = (props) => &#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">//   console.log ('child 被执行了 ')</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">//   return (</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">//     &lt;div>child - &#123; props.b &#125;&lt;/div></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">//   )</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">// &#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">const</span> Child <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'child被执行了'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">child - </span><span class="token punctuation">&#123;</span> props<span class="token punctuation">.</span>b <span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">const</span> Com <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'com被执行了'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">com - </span><span class="token punctuation">&#123;</span> props<span class="token punctuation">.</span>b <span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token keyword">const</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> setA<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>  <span class="token comment">// const [b] = useState(100)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token keyword">const</span> <span class="token punctuation">[</span>b<span class="token punctuation">,</span> setB<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>  <span class="token keyword">const</span> <span class="token punctuation">[</span>list<span class="token punctuation">,</span> setList<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre>  <span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token function">setA</span><span class="token punctuation">(</span>a <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre>  <span class="token keyword">const</span> <span class="token function-variable function">addB</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token function">setB</span><span class="token punctuation">(</span>b <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="40"></td><td><pre></pre></td></tr><tr><td data-num="41"></td><td><pre>  <span class="token comment">// 每次更新生成一个新的引用，意味这属性发生改变</span></pre></td></tr><tr><td data-num="42"></td><td><pre>  <span class="token comment">// const testFn = () => &#123;&#125;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>  <span class="token comment">// 如果记住这个函数 useCallback 以及 useMemo ，从而达到提升组件性能的目的</span></pre></td></tr><tr><td data-num="44"></td><td><pre>  <span class="token comment">//const testFn = useCallback (() => &#123; //useCallback 结构</span></pre></td></tr><tr><td data-num="45"></td><td><pre>  <span class="token comment">//   return (event) => &#123; // 真正的函数实现</span></pre></td></tr><tr><td data-num="46"></td><td><pre>  <span class="token comment">//   &#125;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>  <span class="token comment">// &#125;, []) // 依赖值的改变，重新生成新的引用</span></pre></td></tr><tr><td data-num="48"></td><td><pre>  <span class="token keyword">const</span> testFn <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token comment">// 真正的函数</span></pre></td></tr><tr><td data-num="49"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="50"></td><td><pre></pre></td></tr><tr><td data-num="51"></td><td><pre>  <span class="token comment">// 函数式组件中，通常使用 useMemo 可以实现计算属性</span></pre></td></tr><tr><td data-num="52"></td><td><pre>  <span class="token comment">//const doubleA = a * 2 // 不推荐</span></pre></td></tr><tr><td data-num="53"></td><td><pre>  <span class="token keyword">const</span> doubleA <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token keyword">return</span> a <span class="token operator">*</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="55"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="56"></td><td><pre></pre></td></tr><tr><td data-num="57"></td><td><pre>  <span class="token keyword">const</span> len <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>    <span class="token keyword">return</span> list<span class="token punctuation">.</span>length</pre></td></tr><tr><td data-num="59"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>list<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="60"></td><td><pre>  <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="61"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="62"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></span></span></pre></td></tr><tr><td data-num="63"></td><td><pre>        <span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 深拷贝</span></pre></td></tr><tr><td data-num="64"></td><td><pre>        arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>len<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="65"></td><td><pre>        <span class="token function">setList</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="66"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">></span><span class="token plain-text">追加数据</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span>list<span class="token punctuation">&#125;</span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="67"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span> add <span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">a加1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"> </span><span class="token punctuation">&#123;</span> a <span class="token punctuation">&#125;</span><span class="token plain-text"> - </span><span class="token punctuation">&#123;</span> doubleA <span class="token punctuation">&#125;</span><span class="token plain-text"> - </span><span class="token punctuation">&#123;</span> len <span class="token punctuation">&#125;</span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="68"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span> addB <span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">b加1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"> </span><span class="token punctuation">&#123;</span> b <span class="token punctuation">&#125;</span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="69"></td><td><pre>      <span class="token punctuation">&#123;</span><span class="token comment">/* 理想情况 b 的值发生改变，Child 组件才被重新渲染 */</span><span class="token punctuation">&#125;</span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="70"></td><td><pre>      <span class="token punctuation">&#123;</span><span class="token comment">/* 可以使用高阶组件 React.memo () 包裹一下 Child 组件 */</span><span class="token punctuation">&#125;</span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="71"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Child</span></span> <span class="token attr-name">b</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span> b <span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="72"></td><td><pre></pre></td></tr><tr><td data-num="73"></td><td><pre>      <span class="token punctuation">&#123;</span><span class="token comment">/* 组件的状态发生改变，组件重新渲染，重新渲染，就会给函数生成一个新的地址，意味着全新的一个属性 */</span><span class="token punctuation">&#125;</span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="74"></td><td><pre>      &lt;Com b = <span class="token punctuation">&#123;</span> b <span class="token punctuation">&#125;</span><span class="token plain-text"> testFn = </span><span class="token punctuation">&#123;</span> testFn <span class="token punctuation">&#125;</span><span class="token plain-text">/></span></pre></td></tr><tr><td data-num="75"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="76"></td><td><pre>  <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="77"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="78"></td><td><pre></pre></td></tr><tr><td data-num="79"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>useCallback 应用于 组件的事件，使用 useCallback 包裹组件 - 记忆函数</p><p>useMemo 可以是计算属性， 也应用于 组件的事件，使用 useMemo 包裹组件 - 记忆组件</p></blockquote><h3 id="1728-useimperativehandle"><a class="anchor" href="#1728-useimperativehandle">#</a> 17.2.8 useImperativeHandle</h3><p><code>src/index.js</code></p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// src/index.js</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom/client'</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./12_hooks/10_App_hooks_useImperativeHandle.jsx'</span> <span class="token comment">//useImperativeHandle 父组件操作子组件的方法</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">const</span> root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">// 标签形式调用</span></pre></td></tr><tr><td data-num="11"></td><td><pre>root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>src/12_hooks/10_App_hooks_useImperativeHandle.jsx.jsx</code></p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// const Child = React.forwardRef((props, ref) => &#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">//   return (</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">//     &lt;></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">//       &lt;input ref = &#123; ref &#125;/></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">//     &lt;/></span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">//   )</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">// &#125;)</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">// 可以实现子组件中多个 ref 的使用</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">const</span> Child <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token keyword">const</span> divRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token comment">// 父组件通过 ref 即可 调用 内部自定义的函数 通过透传 ref 解决问题</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  React<span class="token punctuation">.</span><span class="token function">useImperativeHandle</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>      <span class="token function-variable function">inputFocus</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>      <span class="token function">wirteVal</span> <span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        divRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> str</pre></td></tr><tr><td data-num="24"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="29"></td><td><pre>      &lt;input ref = <span class="token punctuation">&#123;</span> inputRef <span class="token punctuation">&#125;</span><span class="token plain-text">/></span></pre></td></tr><tr><td data-num="30"></td><td><pre>      &lt;div ref = <span class="token punctuation">&#123;</span> divRef <span class="token punctuation">&#125;</span><span class="token plain-text">></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="32"></td><td><pre>  <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>  <span class="token keyword">const</span> childRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre>  <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="39"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></span></span></pre></td></tr><tr><td data-num="40"></td><td><pre>        <span class="token comment">// childRef.current.focus()</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        childRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">inputFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token value css language-css">&lt;!--swig￼1--</span></span></span><span class="token punctuation">></span><span class="token plain-text">>获取焦点</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="43"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></span></span></pre></td></tr><tr><td data-num="44"></td><td><pre>        <span class="token comment">// childRef.current.focus()</span></pre></td></tr><tr><td data-num="45"></td><td><pre>        childRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">wirteVal</span><span class="token punctuation">(</span><span class="token string">'hello hooks!!'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token value css language-css">&lt;!--swig￼2--</span></span></span><span class="token punctuation">></span><span class="token plain-text">>写入内容</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="47"></td><td><pre>      &lt;Child ref = <span class="token punctuation">&#123;</span> childRef <span class="token punctuation">&#125;</span><span class="token plain-text">/></span></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="49"></td><td><pre>  <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></pre></td></tr></table></figure><p>上面这个例子中与直接转发 ref 不同，直接转发 ref 是将 <code>React.forwardRef</code> 中函数上的 ref 参数直接应用在了返回元素的 ref 属性上，其实父、子组件引用的是同一个 ref 的 current 对象，官方不建议使用这样的 ref 透传，而使用 <code>useImperativeHandle</code> 后，可以让父、子组件分别有自己的 ref，通过 <code>React.forwardRef</code> 将父组件的 ref 透传过来，通过 <code>useImperativeHandle</code> 方法来自定义开放给父组件的 current。</p><p><code>useImperativeHandle</code> 的第一个参数是定义 current 对象的 ref，第二个参数是一个函数，返回值是一个对象，即这个 ref 的 current 对象，这样可以像上面的案例一样，通过自定义父组件的 ref 来使用子组件 ref 的某些方法。</p><p><code>useImperativeHandle</code> 和 <code>React.forwardRef</code> 必须是配合使用的，这也是为什么在开头要介绍 ref 的转发。</p><h3 id="1729-uselayouteffect"><a class="anchor" href="#1729-uselayouteffect">#</a> 17.2.9 useLayoutEffect</h3><p>useLayoutEffect 与 useEffect 的区别：</p><ul><li><code>useEffect</code> 是异步执行的，而 <code>useLayoutEffect</code> 是同步执行的。</li><li><code>useEffect</code> 的执行时机是浏览器完成渲染之后，而 <code>useLayoutEffect</code> 的执行时机是浏览器把内容真正渲染到界面之前</li></ul><p>举个例子：</p><p><code>src/index.js</code></p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// src/index.js</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom/client'</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./12_hooks/11_App_hooks_useLayoutEffect'</span> <span class="token comment">// useLayoutEffect </span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">const</span> root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">// 标签形式调用</span></pre></td></tr><tr><td data-num="12"></td><td><pre>root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>src/13-App-useLayoutEffect.jsx</code></p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useEffect<span class="token punctuation">,</span> useLayoutEffect<span class="token punctuation">,</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// const App = () => &#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">//   const [count, setCount] = useState(1)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">//   useEffect (() => &#123; // 副作用操作 - 异步操作</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">//     console.log ('useEffect') // 后执行</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">//     document.title = count + '!!'</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">//   &#125;)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">//   useLayoutEffect (() => &#123; // 同步操作 - DOM 相关</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">//     console.log ('useLayoutEffect') // 先执行</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">//     document.title = count</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">//   &#125;) </span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">//   return (</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">//     &lt;div></span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment">//       &lt;h1>useLayoutEffect&lt;/h1></span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">//       &#123; count &#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment">//       &lt;button onClick=&#123; () => &#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">//         setCount(count + 1)</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment">//       &#125;&#125;> 加 1&lt;/button></span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment">//     &lt;/div></span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment">//   );</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment">// &#125;;</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  <span class="token keyword">const</span> <span class="token punctuation">[</span> state1<span class="token punctuation">,</span> setState1 <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token keyword">const</span> <span class="token punctuation">[</span> state2<span class="token punctuation">,</span> setState2 <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'hi'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">1000000000</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>      i<span class="token operator">++</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token function">setState1</span><span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre>  <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">1000000000</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>      i<span class="token operator">++</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token function">setState2</span><span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre>  <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="46"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span>state1<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="47"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span>state2<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="49"></td><td><pre>  <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>注意观察 useEffect 抖动现象</p><p>useLayoutEffect 做 DOM 操作</p><p>useEffect 中 副作用执行</p></blockquote><h3 id="17210-usedebugvalue"><a class="anchor" href="#17210-usedebugvalue">#</a> 17.2.10 useDebugValue</h3><p><code>useDebugValue</code> 可用于在 React 开发者工具中显示自定义 hook 的标签。</p><p><code>src/index.js</code></p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// src/index.js</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom/client'</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">/</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./12_hooks/12_App_hooks_useDebugValue'</span> <span class="token comment">// useDebugValue </span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">const</span> root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">// 标签形式调用</span></pre></td></tr><tr><td data-num="12"></td><td><pre>root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>src/12_hooks/12_App_hooks_useDebugValue.jsx</code></p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useEffect<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useDebugValue <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// const App = () => &#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">//   const [count, setCount] = useState(1)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">//   const add = () => &#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">//     setCount(count + 1)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">//   &#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">//   useEffect(() => &#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">//     document.title = `点击了 $&#123;count&#125; 次`</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">//   &#125;)</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">//   return (</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">//     &lt;div></span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">//       &lt;button onClick=&#123;add&#125;> 加 1&lt;/button></span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">//     &lt;/div></span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment">//   );</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">// &#125;;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment">// 自定义 hook</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">useCount</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token function">useDebugValue</span><span class="token punctuation">(</span><span class="token string">'myCount'</span><span class="token punctuation">)</span> <span class="token comment">// 自定义 Hook 起名</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    count<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    add</pre></td></tr><tr><td data-num="28"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">useTitle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">点击了</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>count<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">次</span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="34"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="35"></td><td><pre>  <span class="token function">useDebugValue</span><span class="token punctuation">(</span><span class="token string">'myTitle'</span><span class="token punctuation">)</span> <span class="token comment">// 自定义 Hook 起名</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>  <span class="token comment">// const [count, setCount] = useState(1)</span></pre></td></tr><tr><td data-num="41"></td><td><pre>  <span class="token comment">// const add = () => &#123;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>  <span class="token comment">//   setCount(count + 1)</span></pre></td></tr><tr><td data-num="43"></td><td><pre>  <span class="token comment">// &#125;</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre>  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> count<span class="token punctuation">,</span> add <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre></pre></td></tr><tr><td data-num="47"></td><td><pre>  <span class="token comment">// useEffect(() => &#123;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>  <span class="token comment">//   document.title = `点击了 $&#123;count&#125; 次`</span></pre></td></tr><tr><td data-num="49"></td><td><pre>  <span class="token comment">// &#125;)</span></pre></td></tr><tr><td data-num="50"></td><td><pre></pre></td></tr><tr><td data-num="51"></td><td><pre>  <span class="token function">useTitle</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="52"></td><td><pre></pre></td></tr><tr><td data-num="53"></td><td><pre>  <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="55"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span> add <span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">加1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="56"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="57"></td><td><pre>  <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></pre></td></tr></table></figure><p>接下来的 hooks 是属于 react18 版本新增的 hooks</p><h3 id="17211-useid"><a class="anchor" href="#17211-useid">#</a> 17.2.11 useId</h3><p><code>useId</code> 是一个钩子，用于生成唯一的 ID，在服务器和客户端之间是稳定的，同时避免 hydration 不匹配。</p><blockquote><p>注意：</p><p><code>useId</code> 不是用来生成列表中的键的。 <code>Keys</code> 应该从你的数据中生成。</p><p>不能用于列表渲染的 key 值</p></blockquote><p>对于一个基本的例子，直接将 id 传递给需要它的元素。</p><p>对于同一组件中的多个 ID，使用相同的 ID 附加一个后缀。</p><p><code>src/index.js</code></p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// src/index.js</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom/client'</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./12_hooks/13_App_hooks_useId'</span> <span class="token comment">// useId </span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">const</span> root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">// 标签形式调用</span></pre></td></tr><tr><td data-num="11"></td><td><pre>root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token operator">&lt;</span>App<span class="token operator">/</span><span class="token operator">></span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>src/12_hooks/13_App_hooks_useId.jsx</code></p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useId <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">//React Hook "useId" cannot be called inside a callback. </span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// React Hooks must be called in a React function component or a custom React Hook function</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">//useId 不能在回调函数中使用，</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">//react hooks 必须包裹在函数式组件或者自定义 hooks 中使用</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token comment">// const [list] = useState(['a', 'b', 'c', 'd'])</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token keyword">const</span> useNameId <span class="token operator">=</span> <span class="token function">useId</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token keyword">const</span> passwordId <span class="token operator">=</span> <span class="token function">useId</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token comment">// list &amp;&amp; list.map((item) => &#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token comment">//   const id = useId () // 这样的写法是错误的</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token comment">//   return (</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token comment">//     &lt;p key = &#123; id &#125;> &#123; item &#125; &lt;/p></span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token comment">//   )</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token comment">// &#125;)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="21"></td><td><pre>      <span class="token punctuation">&#123;</span><span class="token comment">/* HTML 中使用 for，react 中使用 HtmlFor */</span><span class="token punctuation">&#125;</span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="22"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">htmlFor</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span> useNameId <span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">用户名</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="24"></td><td><pre>        &lt;input type="text" id = <span class="token punctuation">&#123;</span> useNameId <span class="token punctuation">&#125;</span><span class="token plain-text"> /></span></pre></td></tr><tr><td data-num="25"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="26"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="27"></td><td><pre>        &lt;label htmlFor = <span class="token punctuation">&#123;</span> passwordId <span class="token punctuation">&#125;</span><span class="token plain-text">>密码</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="28"></td><td><pre>        &lt;input type="password" id = <span class="token punctuation">&#123;</span> passwordId <span class="token punctuation">&#125;</span><span class="token plain-text"> /></span></pre></td></tr><tr><td data-num="29"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="31"></td><td><pre>  <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p><strong>注意：</strong></p><p><code>useId</code> 会生成一个包含 : token 的字符串。这有助于确保令牌是唯一的，但在 CSS 选择器或 API（如 <code>querySelectorAll</code> ）中不支持。</p><p><code>useId</code> 支持一个 <code>identifierPrefix</code> ，以防止在多根应用程序中发生碰撞。要配置，请参阅 <code>hydrateRoot</code> 和 <code>ReactDOMServer</code> 的选项。</p><p>hooks 需要在函数式组件以及自定义 hook 的顶级使用（返回 jsx 代码之前），不要在 jsx 代码中使用 hooks</p></blockquote><h3 id="17212-usedeferredvalue"><a class="anchor" href="#17212-usedeferredvalue">#</a> 17.2.12 useDeferredValue</h3><blockquote><p>真实需求其实不需要实时渲染所有的数据</p></blockquote><p><code>useDeferredValue</code> 需要接收一个值，返回这个值的副本，副本的更新会在值更新渲染之后进行更新，以此来避免一些不必要的重复渲染。打个比方页面中有输入框，输入框下的内容依赖于输入框的值，但是输入框是一个高频操作，如果输入 10 次，可能用户只想看到最终的结果那么中途的实时渲染就显得不那么重要了，页面元素少点还好，一旦元素过多页面就会及其的卡顿，渲染引擎堵得死死的，用户就会骂娘了，此时使用 useDeferredValue 是一个很好的选择</p><p><code>src/index.js</code></p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// src/index.js</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom/client'</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./12_hooks/14_App_hooks_useDeferredValue'</span> <span class="token comment">// useDeferredValue </span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">const</span> root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">// 标签形式调用</span></pre></td></tr><tr><td data-num="11"></td><td><pre>root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span><span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>src/12_hooks/14_App_hooks_useDeferredValue.jsx</code> 数据量必须过大，否则看不到效果</p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useDeferredValue<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useMemo<span class="token punctuation">,</span> memo <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> List <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">List</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    data<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">50000</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      data<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token function">setData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="17"></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>          <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>item<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="21"></td><td><pre>          <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">UseDeferredValueDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token keyword">const</span> <span class="token punctuation">[</span>inpVal<span class="token punctuation">,</span> setInpVal<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>  <span class="token keyword">const</span> deferredValue <span class="token operator">=</span> <span class="token function">useDeferredValue</span><span class="token punctuation">(</span>inpVal<span class="token punctuation">)</span> <span class="token comment">// 备份数据</span></pre></td></tr><tr><td data-num="31"></td><td><pre>  <span class="token keyword">const</span> memoList <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">List</span></span> <span class="token attr-name">count</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>deferredValue<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">List</span></span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token punctuation">[</span>deferredValue<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>  <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="34"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">UseDeferredValue</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="35"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>inpVal<span class="token punctuation">&#125;</span></span>  <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setInpVal</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">/></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="36"></td><td><pre>      <span class="token punctuation">&#123;</span>memoList<span class="token punctuation">&#125;</span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="38"></td><td><pre>  <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="17213-usetransition"><a class="anchor" href="#17213-usetransition">#</a> 17.2.13 useTransition</h3><p><code>useTransition</code> 又叫过渡，他的作用就是标记非紧急更新，这些被标记非紧急更新会在紧急更新完之后进行更新， <code>useTransition</code> 使用场景在应对渲染量很大的页面，需要及时响应某些事件的情况。</p><p>举个例子，准备一个进度条，通过滑动进度条来显示进度条的进度并且渲染相同进度数量的 div, 如果我们不对渲染进行优化那无疑页面会很卡，此时使用过渡配合 useMemo 来缓存页面结构，diffing 算法就会对比出少量的变化进行局部修改。</p><p><code>src/index.js</code></p><figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// src/index.js</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom/client'</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">/</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./12_hooks/15_App_hooks_useTransition'</span> <span class="token comment">// useTransition </span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">const</span> root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">// 标签形式调用</span></pre></td></tr><tr><td data-num="12"></td><td><pre>root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token operator">&lt;</span>App<span class="token operator">/</span><span class="token operator">></span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>src/12_hooks/15_App_hooks_useTransition</code></p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useTransition<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useMemo <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span></pre></td></tr><tr><td data-num="2"></td><td><pre> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">UseTransition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">const</span> <span class="token punctuation">[</span>isPending<span class="token punctuation">,</span> startTransition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useTransition</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre> </pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token keyword">const</span> <span class="token punctuation">[</span>rangeValue<span class="token punctuation">,</span> setRangeValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">const</span> <span class="token punctuation">[</span>renderData<span class="token punctuation">,</span> setRenderData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token keyword">const</span> <span class="token punctuation">[</span>isStartTransition<span class="token punctuation">,</span> setIsStartTransition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token keyword">const</span> <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token function">setRangeValue</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    arr<span class="token punctuation">.</span>length <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value</pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>      arr<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>isStartTransition<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>      <span class="token function">startTransition</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token function">setRenderData</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>      <span class="token function">setRenderData</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token keyword">const</span> jsx <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">return</span> renderData<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>      <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span></span></pre></td></tr><tr><td data-num="28"></td><td><pre>          <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token value css language-css">&lt;!--swig￼3--</span></span></span><span class="token punctuation">></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="29"></td><td><pre>          key=<span class="token punctuation">&#123;</span><span class="token string">'item'</span><span class="token operator">+</span>index<span class="token punctuation">&#125;</span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="30"></td><td><pre>        ></pre></td></tr><tr><td data-num="31"></td><td><pre>          <span class="token punctuation">&#123;</span>item<span class="token punctuation">&#125;</span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="33"></td><td><pre>      <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>renderData<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre>  <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="38"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token value css language-css">&lt;!--swig￼4--</span></span></span><span class="token punctuation">></span></span><span class="token plain-text">></span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="40"></td><td><pre>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span></span></pre></td></tr><tr><td data-num="41"></td><td><pre>            <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span></pre></td></tr><tr><td data-num="42"></td><td><pre>            <span class="token attr-name">checked</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>isStartTransition<span class="token punctuation">&#125;</span></span></pre></td></tr><tr><td data-num="43"></td><td><pre>            <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></span></pre></td></tr><tr><td data-num="44"></td><td><pre>              <span class="token function">setIsStartTransition</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>checked<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="45"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>          <span class="token punctuation">/></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="47"></td><td><pre>          useTransition</pre></td></tr><tr><td data-num="48"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="49"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span></span></pre></td></tr><tr><td data-num="50"></td><td><pre>          <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>range<span class="token punctuation">"</span></span></pre></td></tr><tr><td data-num="51"></td><td><pre>          <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>rangeValue<span class="token punctuation">&#125;</span></span></pre></td></tr><tr><td data-num="52"></td><td><pre>          <span class="token attr-name">min</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span></span></pre></td></tr><tr><td data-num="53"></td><td><pre>          <span class="token attr-name">max</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token number">10000</span><span class="token punctuation">&#125;</span></span></pre></td></tr><tr><td data-num="54"></td><td><pre>          <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token value css language-css">&lt;!--swig￼5--</span></span></span><span class="token punctuation">></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="55"></td><td><pre>          onChange=<span class="token punctuation">&#123;</span>handleChange<span class="token punctuation">&#125;</span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="56"></td><td><pre>        /></pre></td></tr><tr><td data-num="57"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span><span class="token plain-text">进度条 </span><span class="token punctuation">&#123;</span>rangeValue<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="58"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span> <span class="token punctuation">/></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="59"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="60"></td><td><pre>      <span class="token punctuation">&#123;</span>jsx<span class="token punctuation">&#125;</span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="61"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="62"></td><td><pre>  )</pre></td></tr><tr><td data-num="63"></td><td><pre>&#125;</pre></td></tr></table></figure><h3 id="17214-usesyncexternalstore"><a class="anchor" href="#17214-usesyncexternalstore">#</a> 17.2.14 useSyncExternalStore</h3><p>React18 的 beta 版本将 <code>useMutableSource</code> 更新为了 <code>useSyncExternalStore</code> ，这个新的 api 将会对 React 的各种状态管理库产生非常大的影响，下面我来介绍 <code>useSyncExternalStore</code> 的用法和场景。</p><p>我们可以通过这个 api 自行设计一个 redux + react-redux 的数据方案：</p><p><strong>1、设计 store</strong></p><p>首先我们要设计一个 store，它必须有如下属性：</p><ul><li>currentState: 当前状态</li><li>subscribe: 提供状态发生变化时的订阅能力</li><li>getSnapshot: 获取当前状态</li></ul><p>以及改变 state 的方法，这里参考 redux，设计了 dispatch、reducer</p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token literal-property property">currentState</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token literal-property property">data</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token literal-property property">listeners</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">switch</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token keyword">case</span> <span class="token string">'ADD'</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">data</span><span class="token operator">:</span>store<span class="token punctuation">.</span>currentState<span class="token punctuation">.</span>data<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token keyword">default</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>                <span class="token keyword">return</span> store<span class="token punctuation">.</span>state</pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token parameter">l</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        store<span class="token punctuation">.</span>listeners<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token function">getSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token keyword">return</span> store<span class="token punctuation">.</span>currentState</pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        store<span class="token punctuation">.</span>currentState <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">reducer</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        store<span class="token punctuation">.</span>listeners<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">l</span><span class="token operator">=></span><span class="token function">l</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token keyword">return</span> action<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>2、应用 store 同步组件状态</strong></p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useSyncExternalStore <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store'</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">UseSyncExternalStoreDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">useSyncExternalStore</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>subscribe<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> store<span class="token punctuation">.</span><span class="token function">getSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    </pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">count: </span><span class="token punctuation">&#123;</span>state<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'ADD'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">add+</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span></pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="17215-useinsertioneffect"><a class="anchor" href="#17215-useinsertioneffect">#</a> 17.2.15 useInsertionEffect</h3><p><code>useInsertionEffect</code> 与 useEffect 相同，在所有 DOM 变更之前同步触发。在使用 useLayoutEffect 读取布局之前，使用这个函数将样式注入到 DOM 中。因为这个钩子的作用域是有限的，所以这个钩子不能访问 refs，也不能调度更新。</p><figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useInsertionEffect<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useLayoutEffect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span></pre></td></tr><tr><td data-num="2"></td><td><pre> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">UseInsertionEffect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token function">useInsertionEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'useInsertionEffect'</span><span class="token punctuation">)</span> <span class="token comment">// 1</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">// const style = document.createElement('style')</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// style.innerHTML = '.box &#123; color: red &#125;'</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">// document.head.appendChild(style)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'useEffect'</span><span class="token punctuation">)</span> <span class="token comment">// 3</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'useLayoutEffect'</span><span class="token punctuation">)</span> <span class="token comment">// 2</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token keyword">return</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">UseInsertionEffect</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="173-自定义hooks"><a class="anchor" href="#173-自定义hooks">#</a> 17.3 自定义 hooks</h2><p>以 use 开头的小驼峰式的函数</p><div class="tags"><a href="/tags/react/" rel="tag"><i class="ic i-tag"></i> react</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-10-31 10:21:22" itemprop="dateModified" datetime="2022-10-31T10:21:22+08:00">2022-10-31</time> </span><span id="react-study/7/" class="item leancloud_visitors" data-flag-title="React学习第七天" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 联系我</button><p>来交朋友吧！</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="叶星辰 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="叶星辰 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="叶星辰 QQ"><p>QQ</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>叶星辰 <i class="ic i-at"><em>@</em></i>永不陨落的星辰</li><li class="link"><strong>本文链接：</strong> <a href="https://www.yexingcheng.com/react-study/7/" title="React学习第七天">https://www.yexingcheng.com/react-study/7/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/react-study/6/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva3.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipet8c1a2j20zk0m8kct.jpg" title="React学习第六天"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> react学习</span><h3>React学习第六天</h3></a></div><div class="item right"><a href="/react-study/8/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva3.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipetlbztpj20zk0m84qp.jpg" title="React学习第八天"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> react学习</span><h3>React学习第八天</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%B8%83-hooks"><span class="toc-number">1.</span> <span class="toc-text">十七、hooks</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#171-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8hooks"><span class="toc-number">1.1.</span> <span class="toc-text">17.1 为什么使用 hooks</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#172%E5%B8%B8%E8%A7%81%E7%9A%84hooks"><span class="toc-number">1.2.</span> <span class="toc-text">17.2 常见的 hooks</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1721-usestate"><span class="toc-number">1.2.1.</span> <span class="toc-text">17.2.1 useState</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1722-useeffect"><span class="toc-number">1.2.2.</span> <span class="toc-text">17.2.2 useEffect</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1723-useref"><span class="toc-number">1.2.3.</span> <span class="toc-text">17.2.3 useRef</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1724-usereducer"><span class="toc-number">1.2.4.</span> <span class="toc-text">17.2.4 useReducer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1725-usecontext"><span class="toc-number">1.2.5.</span> <span class="toc-text">17.2.5 useContext</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1726-usememo"><span class="toc-number">1.2.6.</span> <span class="toc-text">17.2.6 useMemo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1727-usecallback"><span class="toc-number">1.2.7.</span> <span class="toc-text">17.2.7 useCallback</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1728-useimperativehandle"><span class="toc-number">1.2.8.</span> <span class="toc-text">17.2.8 useImperativeHandle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1729-uselayouteffect"><span class="toc-number">1.2.9.</span> <span class="toc-text">17.2.9 useLayoutEffect</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#17210-usedebugvalue"><span class="toc-number">1.2.10.</span> <span class="toc-text">17.2.10 useDebugValue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#17211-useid"><span class="toc-number">1.2.11.</span> <span class="toc-text">17.2.11 useId</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#17212-usedeferredvalue"><span class="toc-number">1.2.12.</span> <span class="toc-text">17.2.12 useDeferredValue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#17213-usetransition"><span class="toc-number">1.2.13.</span> <span class="toc-text">17.2.13 useTransition</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#17214-usesyncexternalstore"><span class="toc-number">1.2.14.</span> <span class="toc-text">17.2.14 useSyncExternalStore</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#17215-useinsertioneffect"><span class="toc-number">1.2.15.</span> <span class="toc-text">17.2.15 useInsertionEffect</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#173-%E8%87%AA%E5%AE%9A%E4%B9%89hooks"><span class="toc-number">1.3.</span> <span class="toc-text">17.3 自定义 hooks</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/react-study/1/" rel="bookmark" title="React学习第一天">React学习第一天</a></li><li><a href="/react-study/2/" rel="bookmark" title="React学习第二天">React学习第二天</a></li><li><a href="/react-study/3/" rel="bookmark" title="React学习第三天">React学习第三天</a></li><li><a href="/react-study/4/" rel="bookmark" title="React学习第四天">React学习第四天</a></li><li><a href="/react-study/5/" rel="bookmark" title="React学习第五天">React学习第五天</a></li><li><a href="/react-study/6/" rel="bookmark" title="React学习第六天">React学习第六天</a></li><li class="active"><a href="/react-study/7/" rel="bookmark" title="React学习第七天">React学习第七天</a></li><li><a href="/react-study/8/" rel="bookmark" title="React学习第八天">React学习第八天</a></li><li><a href="/react-study/react-router-params/" rel="bookmark" title="React路由传参的几种方式">React路由传参的几种方式</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="叶星辰" data-src="/images/avatar.jpg"><p class="name" itemprop="name">叶星辰</p><div class="description" itemprop="description">温柔正确的人总是难以生存，因为这个世界既不温柔 也不正确</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">39</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">7</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">17</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0NhMW1EMHduMQ==" title="https:&#x2F;&#x2F;github.com&#x2F;Ca1mD0wn1"><i class="ic i-github"></i></span> <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9VZmRIbw==" title="https:&#x2F;&#x2F;twitter.com&#x2F;UfdHo"><i class="ic i-twitter"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9tZW5nLXhpbmcteW91LWppLXNpLXl1ZS1odWFuZy0yNw==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;meng-xing-you-ji-si-yue-huang-27"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTUwMjkxOTQ0NQ==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;502919445"><i class="ic i-cloud-music"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20vdS83NTc4MjU1ODg1" title="https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;7578255885"><i class="ic i-weibo"></i></span> <span class="exturl item email" data-url="aHR0cHM6Ly9tYWlsLmdvb2dsZS5jb20vbWFpbC91LzAvI2luYm94" title="https:&#x2F;&#x2F;mail.google.com&#x2F;mail&#x2F;u&#x2F;0&#x2F;#inbox"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>links</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/react-study/6/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/react-study/8/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/interview/" title="分类于 面试用">面试用</a></div><span><a href="/interview/programming/" title="编程题总结">编程题总结</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/vue3%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/" title="分类于 vue3移动端项目开发">vue3移动端项目开发</a></div><span><a href="/vue-mobile/10/" title="vue-mobile项目开发流程第十部分(构建joinshopcar页面)">vue-mobile项目开发流程第十部分(构建joinshopcar页面)</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/interview/" title="分类于 面试用">面试用</a></div><span><a href="/algorithm/toTree/" title="扁平数据结构转tree">扁平数据结构转tree</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/vue3%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/" title="分类于 vue3移动端项目开发">vue3移动端项目开发</a></div><span><a href="/vue-mobile/4/" title="vue-mobile项目开发流程第四部分(开始构建项目)">vue-mobile项目开发流程第四部分(开始构建项目)</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/react%E5%AD%A6%E4%B9%A0/" title="分类于 react学习">react学习</a></div><span><a href="/react-study/1/" title="React学习第一天">React学习第一天</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/index/" title="分类于 index">index</a></div><span><a href="/Blog_introduction/Blog_introduction/" title="Welcome!">Welcome!</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/vue3%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/" title="分类于 vue3移动端项目开发">vue3移动端项目开发</a></div><span><a href="/vue-mobile/7/" title="vue-mobile项目开发流程第七部分(构建detail页面)">vue-mobile项目开发流程第七部分(构建detail页面)</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/react%E5%AD%A6%E4%B9%A0/" title="分类于 react学习">react学习</a></div><span><a href="/react-study/4/" title="React学习第四天">React学习第四天</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/interview/" title="分类于 面试用">面试用</a></div><span><a href="/interview/Variable-recycling/" title="JS变量回收机制">JS变量回收机制</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/vue3%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/" title="分类于 vue3移动端项目开发">vue3移动端项目开发</a></div><span><a href="/vue-mobile/12/" title="vue-mobile项目开发流程第十二部分(实现提交订单功能)">vue-mobile项目开发流程第十二部分(实现提交订单功能)</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2021 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">叶星辰 @ 永不陨落的星辰</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">581k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">8:48</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"react-study/7/",favicon:{show:"星辰",hide:"你快回来"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({model:{jsonPath:"/live2dw/assets/miku.model.json"},display:{position:"right",width:250,height:500},mobile:{show:!1},log:!1,pluginJsPath:"lib/",pluginModelPath:"assets/",pluginRootPath:"live2dw/",tagMode:!1})</script></body></html><!-- rebuild by hrmmi -->