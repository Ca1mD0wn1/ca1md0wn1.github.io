<!-- build time:Wed Nov 09 2022 02:20:30 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="永不陨落的星辰" href="https://www.yexingcheng.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="永不陨落的星辰" href="https://www.yexingcheng.com/atom.xml"><link rel="alternate" type="application/json" title="永不陨落的星辰" href="https://www.yexingcheng.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="react"><link rel="canonical" href="https://www.yexingcheng.com/react-study/8/"><title>React学习第八天 - react学习 | 永不陨落的星辰 = 永不陨落的星辰</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">React学习第八天</h1><div class="meta"><span class="item" title="创建时间：2022-08-08 00:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-08-08T00:00:00+08:00">2022-08-08</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>37k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>33 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">永不陨落的星辰</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gipev1x5e4j20zk0m8b29.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gipevuctzzj20zk0m84qp.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gipexbei4hj20zk0m8npd.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gipeu1usa7j20zk0m8b29.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gipet4bz0yj20zk0m8e81.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giclh3brzpj20zk0m8ann.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/react%E5%AD%A6%E4%B9%A0/" itemprop="item" rel="index" title="分类于 react学习"><span itemprop="name">react学习</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.yexingcheng.com/react-study/8/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="叶星辰"><meta itemprop="description" content=", 温柔正确的人总是难以生存，因为这个世界既不温柔 也不正确"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="永不陨落的星辰"></span><div class="body md" itemprop="articleBody"><h1 id="十八、Redux"><a href="#十八、Redux" class="headerlink" title="十八、Redux"></a>十八、Redux</h1><h2 id="18-1-理解Flux架构"><a href="#18-1-理解Flux架构" class="headerlink" title="18.1 理解Flux架构"></a>18.1 理解Flux架构</h2><p>在2013年，Facebook让<code>React</code>亮相的同时推出了Flux框架，<code>React</code>的初衷实际上是用来替代<code>jQuery</code>的，<code>Flux</code>实际上就可以用来替代<code>Backbone.js</code>，<code>Ember.js</code>等一系列<code>MVC</code>架构的前端JS框架。</p><p>其实<code>Flux</code>在<code>React</code>里的应用就类似于<code>Vue</code>中的<code>Vuex</code>的作用，但是在<code>Vue</code>中，<code>Vue</code>是完整的<code>mvvm</code>框架，而<code>Vuex</code>只是一个全局的插件。</p><p><code>React</code>只是一个MVC中的V(视图层)，只管页面中的渲染，一旦有数据管理的时候，<code>React</code>本身的能力就不足以支撑复杂组件结构的项目，在传统的<code>MVC</code>中，就需要用到Model和Controller。Facebook对于当时世面上的<code>MVC</code>框架并不满意，于是就有了<code>Flux</code>, 但<code>Flux</code>并不是一个<code>MVC</code>框架，他是一种新的思想。</p><p><img data-src="/react-study/8/flux.png" alt="image-20220812002755397"></p><ul><li>View： 视图层</li><li>ActionCreator（动作创造者）：视图层发出的消息（比如mouseClick）</li><li>Dispatcher（派发器）：用来接收Actions、执行回调函数</li><li>Store（数据层）：用来存放应用的状态，一旦发生变动，就提醒Views要更新页面</li></ul><p>Flux的流程：</p><ol><li>组件获取到store中保存的数据挂载在自己的状态上</li><li>用户产生了操作，调用actions的方法</li><li>actions接收到了用户的操作，进行一系列的逻辑代码、异步操作</li><li>然后actions会创建出对应的action，action带有标识性的属性</li><li>actions调用dispatcher的dispatch方法将action传递给dispatcher</li><li>dispatcher接收到action并根据标识信息判断之后，调用store的更改数据的方法</li><li>store的方法被调用后，更改状态，并触发自己的某一个事件</li><li>store更改状态后事件被触发，该事件的处理程序会通知view去获取最新的数据</li></ol><h2 id="18-2-理解Redux单向数据流流程"><a href="#18-2-理解Redux单向数据流流程" class="headerlink" title="18.2 理解Redux单向数据流流程"></a>18.2 理解Redux单向数据流流程</h2><p>React 只是 DOM 的一个抽象层，并不是 Web 应用的完整解决方案。有两个方面，它没涉及。</p><ul><li>代码结构</li><li>组件之间的通信</li></ul><p>2013年 Facebook 提出了 Flux 架构的思想，引发了很多的实现。2015年，Redux 出现，将 Flux 与<span class="exturl" data-url="aHR0cHM6Ly9sbGg5MTEwMDEuZ2l0Ym9va3MuaW8vbW9zdGx5LWFkZXF1YXRlLWd1aWRlLWNoaW5lc2UvY29udGVudC8=">函数式编程</span>结合一起，很短时间内就成为了最热门的前端架构。</p><p>如果你不知道是否需要 Redux，那就是不需要它</p><p>只有遇到 React 实在解决不了的问题，你才需要 Redux</p><p>简单说，如果你的UI层非常简单，没有很多互动，Redux 就是不必要的，用了反而增加复杂性。</p><ul><li>用户的使用方式非常简单</li><li>用户之间没有协作</li><li>不需要与服务器大量交互，也没有使用 WebSocket</li><li>视图层（View）只从单一来源获取数据</li></ul><p><strong>需要使用Redux的项目:</strong></p><ul><li>用户的使用方式复杂</li><li>不同身份的用户有不同的使用方式（比如普通用户和管理员）</li><li>多个用户之间可以协作</li><li>与服务器大量交互，或者使用了WebSocket</li><li>View要从多个来源获取数据</li></ul><p><strong>从组件层面考虑，什么样子的需要Redux：</strong></p><ul><li>某个组件的状态，需要共享</li><li>某个状态需要在任何地方都可以拿到</li><li>一个组件需要改变全局状态</li><li>一个组件需要改变另一个组件的状态</li></ul><p><strong>Redux的设计思想：</strong></p><ol><li>Web 应用是一个状态机，视图与状态是一一对应的。</li><li>所有的状态，保存在一个对象里面（唯一数据源）。</li></ol><blockquote><p>注意：flux、redux都不是必须和react搭配使用的，因为flux和redux是完整的架构，在学习react的时候，只是将react的组件作为redux中的视图层去使用了。</p></blockquote><p><img data-src="/image%5Credux" alt="image-20220812002936378"></p><h2 id="18-3-redux使用三大原则"><a href="#18-3-redux使用三大原则" class="headerlink" title="18.3 redux使用三大原则"></a>18.3 redux使用三大原则</h2><ul><li>Single Source of Truth(唯一的数据源)</li><li>State is read-only(状态是只读的) - 无法直接修改状态</li><li>Changes are made with pure function(数据的改变必须通过纯函数完成)</li></ul><pre><code class="sh">$ cnpm i redux -S
</code></pre><p><code>src/13_redux/store.js</code> 创建状态管理器</p><pre><code class="js">// createStore 方法在新版本中已经被弃用
import &#123; createStore &#125; from &#39;redux&#39;

// 2.创建所有操作 reducer 以及定义初始化的状态 - 纯函数
// 第一个参数为管理的状态，需要在此处书写 初始的状态
const reducer = (state = &#123;
  msg: &#39;hello redux&#39;,
  count: 10
&#125;, action) =&gt; &#123; // action中type代表动作的标识，用于触发行为，payload代表传递的参数
  switch (action.type) &#123;
    case &#39;CAHNGE_MSG&#39;: // type的名字可以根据自己公司的需求进行更改
      // 必须返回最新的状态
      return &#123; ...state, msg: action.payload &#125;
    case &#39;INCREMENT_COUNT&#39;:
      return &#123; ...state, count: state.count + action.payload &#125;
    case &#39;DECREMENT_COUNT&#39;:
      return Object.assign(&#123;&#125;, state, &#123; count: state.count - action.payload &#125;)
    default:
      return state
  &#125;
&#125;

// 创建状态管理器
const store = createStore(reducer)

export default store
</code></pre><p><code>src/index.js</code> 配置状态管理器 - 状态管理器修改订阅视图的更新</p><pre><code class="js">// src/index.js
import React from &#39;react&#39;
import ReactDOM from &#39;react-dom/client&#39;

// 引入状态管理器
import store from &#39;./13_redux/store&#39;

import App from &#39;./13_redux/App&#39; 

console.log(store)
// dispatch 可以触发reducer的更改
// getState 可以用来获取状态管理器的数据
// replaceReducer 替换reducer
// subscribe 订阅数据的变化

const root = ReactDOM.createRoot(document.getElementById(&#39;root&#39;))

// 标签形式调用
root.render(
  &lt;App/&gt;
)

// 订阅数据的变化，重新渲染视图
store.subscribe(() =&gt; &#123;
  // 一旦检测到数据发生改变，此处代码就会执行
  root.render(
    &lt;App/&gt;
  )
&#125;)
</code></pre><p><code>src/13_redux/App.jsx</code>使用状态管理器</p><pre><code class="jsx">import React from &#39;react&#39;;
import Child1 from &#39;./Child1&#39;;
import Child2 from &#39;./Child2&#39;;
const App = () =&gt; &#123;
  return (
    &lt;div&gt;
      &lt;h1&gt;使用redux&lt;/h1&gt;
      &lt;Child1 /&gt;
      &lt;hr/&gt;
      &lt;Child2 /&gt;
    &lt;/div&gt;
  );
&#125;;

export default App;
</code></pre><p><code>src/13_redux/Child1.jsx</code></p><pre><code class="jsx">import React from &#39;react&#39;;
import store from &#39;./store&#39;
const Child1 = () =&gt; &#123;
  const state = store.getState() // 获取状态管理器中的状态
  return (
    &lt;div&gt;
      &lt;h3&gt;child1&lt;/h3&gt;
      &lt;div&gt;
        &#123; state.msg &#125; - &#123; state.count &#125;
        &lt;button onClick=&#123;() =&gt; &#123;
          store.dispatch(&#123;
            type: &#39;CAHNGE_MSG&#39;,
            payload: &#39;hello child1 redux&#39;
          &#125;)
        &#125;&#125;&gt;修改msg&lt;/button&gt;
        &lt;button onClick=&#123; () =&gt; &#123;
          store.dispatch(&#123;
            type: &#39;INCREMENT_COUNT&#39;,
            payload: 10
          &#125;)
        &#125; &#125;&gt;加10&lt;/button&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
&#125;;

export default Child1;
</code></pre><p><code>src/13_redux/Child2.jsx</code></p><pre><code class="jsx">import React from &#39;react&#39;;
import store from &#39;./store&#39;
const Child2 = () =&gt; &#123;
  const state = store.getState() // 获取状态管理器中的状态
  return (
    &lt;div&gt;
      &lt;h3&gt;child2&lt;/h3&gt;
      &#123; state.msg &#125; - &#123; state.count &#125;
      &lt;button onClick=&#123;() =&gt; &#123;
          store.dispatch(&#123;
            type: &#39;CAHNGE_MSG&#39;,
            payload: &#39;hello child2 redux&#39;
          &#125;)
        &#125;&#125;&gt;修改msg&lt;/button&gt;
         &lt;button onClick=&#123; () =&gt; &#123;
          store.dispatch(&#123;
            type: &#39;DECREMENT_COUNT&#39;,
            payload: 10
          &#125;)
        &#125; &#125;&gt;减10&lt;/button&gt;
    &lt;/div&gt;
  );
&#125;;

export default Child2;
</code></pre><p>以上代码是最最最最最最最基本的redux的使用，现在企业里基本上不使用这种原始的方法</p><h2 id="18-4-redux-react-redux配合使用"><a href="#18-4-redux-react-redux配合使用" class="headerlink" title="18.4 redux + react-redux配合使用"></a>18.4 redux + react-redux配合使用</h2><blockquote><p>redux是属于js的状态管理模式，不独属于react，在react中需要结合 react-redux 模块使用</p></blockquote><p>react-redux提供两个核心的api：</p><ul><li><p>Provider: 提供store <code>&lt;Provider store = &#123; store &#125;&gt;&lt;App /&gt;&lt;/store&gt;</code></p></li><li><p>connect: 用于连接容器组件和展示组件</p><ul><li><p>Provider</p><p>根据单一store原则 ，一般只会出现在整个应用程序的最顶层。</p></li><li><p>connect</p><p>语法格式为</p><p><code>connect(mapStateToProps?, mapDispatchToProps?, mergeProps?, options?)(component)</code></p><p>一般来说只会用到前面两个，它的作用是：</p><ul><li>把<code>store.getState()</code>的状态转化为展示组件的<code>props</code></li><li>把<code>actionCreators</code>转化为展示组件<code>props</code>上的方法</li></ul></li></ul></li></ul><p>只要上层中有<code>Provider</code>组件并且提供了<code>store</code>, 那么，子孙级别的任何组件，要想使用<code>store</code>里的状态，都可以通过<code>connect</code>方法进行连接。如果只是想连接<code>actionCreators</code>，可以第一个参数传递为<code>null</code></p><pre><code class="sh">$ cnpm i react-redux -S
</code></pre><h3 id="18-4-1-创建状态管理器"><a href="#18-4-1-创建状态管理器" class="headerlink" title="18.4.1 创建状态管理器"></a>18.4.1 创建状态管理器</h3><p><code>src/14_redux-react_redux/store.js</code></p><pre><code class="js">import &#123; createStore &#125; from &#39;redux&#39;

const reducer = (state = &#123;
  proList: [],
  kindList: []
&#125;, &#123; type, payload &#125;) =&gt; &#123; // action  解构了 &#123; type, payload &#125;
  switch (type) &#123;
    case &#39;CHANGE_PRO_LIST&#39;:
      return &#123; ...state, proList: payload &#125;
    case &#39;CHANGE_KIND_LIST&#39;:
      return &#123; ...state, kindList: payload &#125;
    default:
      return state
  &#125;
&#125;

const store = createStore(reducer)

export default store
</code></pre><blockquote><p>1.引入 createStore 方法（新版本中建议使用rtk）</p><p>2.创建reducer（包含初始化状态，包含了修改状态的标识，返回了新的状态（对象合并））</p><p>3.创建store</p><p>4.暴露store</p></blockquote><h3 id="18-4-2-使用react-redux"><a href="#18-4-2-使用react-redux" class="headerlink" title="18.4.2  使用react-redux"></a>18.4.2 使用react-redux</h3><p><code>src/index.js</code></p><pre><code class="js">// src/index.js
import React from &#39;react&#39;
import ReactDOM from &#39;react-dom/client&#39;

// 引入状态管理器
import &#123; Provider &#125; from &#39;react-redux&#39; // 提供Provier组件，可以添加store属性
import store from &#39;./14_redux_react-redux/store&#39;
import App from &#39;./14_redux_react-redux/App&#39;

const root = ReactDOM.createRoot(document.getElementById(&#39;root&#39;))

// 标签形式调用
root.render(
  &lt;Provider store = &#123; store &#125;&gt;
    &lt;App/&gt;
  &lt;/Provider&gt;
)
</code></pre><blockquote><p>使用了 react-redux 提供的组件组件 Provider 配合 store 完成传递数据</p></blockquote><p><code>src/14_redux_react-redux/App.jsx</code></p><pre><code class="jsx">import React from &#39;react&#39;;
import Home from &#39;./Home&#39;;
import Kind from &#39;./Kind&#39;;
const App = () =&gt; &#123;
  return (
    &lt;div&gt;
      &lt;h1&gt;redux + react-redux&lt;/h1&gt;
      &lt;Home /&gt;
      &lt;hr /&gt;
      &lt;Kind /&gt;
    &lt;/div&gt;
  );
&#125;;

export default App;
</code></pre><p><code>src/14_redux_react-redux/Home.jsx</code> 业务逻辑写到了组件中</p><pre><code class="jsx">import React, &#123; useEffect &#125; from &#39;react&#39;;
// 引入 connect 高阶组件 实际上 connect() 返回值才是高阶组件
import &#123; connect &#125; from &#39;react-redux&#39;;

// 展示组件   ---- 理想情况：  负责数据的展示以及发起指令
const Home = (props) =&gt; &#123;
  console.log(props) // &#123; proList: [], dispatch: function()&#125;
  const &#123; proList, dispatch &#125; = props
  useEffect(() =&gt; &#123;
    // 在展示组件内 写业务逻辑
    fetch(&#39;http://121.89.205.189:3001/api/pro/list&#39;).then(res =&gt; res.json()).then(res =&gt; &#123;
      console.log(res.data) 
      // 修改状态
      dispatch(&#123;
        type: &#39;CHANGE_PRO_LIST&#39;,
        payload: res.data
      &#125;)
    &#125;)
  &#125;, [dispatch]) // 依赖项最好 不要直接使用props，先将props进行解构，后添加依赖项
  return (
    &lt;div&gt;
      &lt;h3&gt;home&lt;/h3&gt;
      &lt;ul&gt;
        &#123;
          proList &amp;&amp; proList.map(item =&gt; &#123;
            return (&lt;li key = &#123; item.proid &#125;&gt;&#123; item.proname &#125;&lt;/li&gt;)
          &#125;)
        &#125;
      &lt;/ul&gt;
    &lt;/div&gt;
  );
&#125;;

// mapStateToProps 负责给展示组件提供数据，提供给展示组件的props属性
const mapStateToProps = (state) =&gt; &#123; // state 参数即为管理的所有的状态
  return &#123; // 必须含有返回值，返回什么取决于你的展示组件需要什么数据
    proList: state.proList
  &#125;
&#125;
// 返回的是一个 容器组件  ---- 理想情况： 负责给展示组件提供数据 以及执行 业务逻辑
export default connect(mapStateToProps)(Home);
</code></pre><p><code>src/14_redux_react-redux/Kind.jsx</code> 业务逻辑写到容器组件中</p><pre><code class="jsx">import React, &#123; useEffect &#125; from &#39;react&#39;;
import &#123; connect &#125; from &#39;react-redux&#39;
const Kind = (props) =&gt; &#123;
  const &#123; kindList, getKindListData &#125; = props
  useEffect(() =&gt; &#123;
    // 展示组件发起指令，后续交给容器组件处理
    getKindListData()
  &#125;, [getKindListData])
  return (
    &lt;div&gt;
      &lt;h3&gt;kind&lt;/h3&gt;
      &#123;
        kindList &amp;&amp; kindList.map(item =&gt; &#123;
          return (
            &lt;p key = &#123; item &#125;&gt; &#123; item &#125; &lt;/p&gt;
          )
        &#125;)
      &#125;
    &lt;/div&gt;
  );
&#125;;
const mapStateToProps = (state) =&gt; &#123;
  return &#123;
    kindList: state.kindList
  &#125;
&#125;

// 将业务逻辑交给容器组件组件处理
const mapDispatchToProps = (dispatch) =&gt; &#123; // dispatch 为默认参数，可以通过此 触发 reducer 中状态的更新
  return &#123;
    getKindListData () &#123; // 返回自定义函数，供 展示组件调用，展示组件通过 props 访问即可
      fetch(&#39;http://121.89.205.189:3001/api/pro/categorylist&#39;).then(res =&gt; res.json()).then(res =&gt; &#123;
        console.log(res.data) 
        // 修改状态
        dispatch(&#123;
          type: &#39;CHANGE_KIND_LIST&#39;,
          payload: res.data
        &#125;)
      &#125;)
    &#125;
  &#125;
&#125;
export default connect(mapStateToProps, mapDispatchToProps)(Kind);
</code></pre><blockquote><p>vuex中 可以把异步操作提取到vuex中的actions中，react中异步操作方式会有很多，最常见的就是 redux-thunk</p></blockquote><h2 id="18-5-redux-react-redux分模块使用"><a href="#18-5-redux-react-redux分模块使用" class="headerlink" title="18.5 redux+react-redux分模块使用"></a>18.5 redux+react-redux分模块使用</h2><blockquote><p>如果项目很大，或者项目划分比较明确，需要将状态管理器也分模块去处理</p><p>假设现在有一个home模块，管理 bannerList 以及 proList</p><p>还有一个模块 kind 模块，管理 kindList</p></blockquote><p><code>src/15_redux_react-redux_combine/store/modules/home.js</code></p><pre><code class="js">// 单独管理home模块的状态管理器
const reducer = (state = &#123;
  bannerList: [],
  proList: []
&#125;, &#123; type, payload &#125;) =&gt; &#123;
  switch (type) &#123;
    case &#39;CHANGE_BANNER_LIST&#39;:
      return &#123; ...state, bannerList: payload &#125;
    case &#39;CHANGE_PRO_LIST&#39;:
      return &#123; ...state, proList: payload &#125;
    default:
      return state
  &#125;
&#125;

export default reducer
</code></pre><p><code>src/15_redux_react-redux_combine/store/modules/kind.js</code></p><pre><code class="js">// 单独管理kind模块的状态管理器
const reducer = (state = &#123;
  kindList: []
&#125;, &#123; type, payload &#125;) =&gt; &#123;
  switch (type) &#123;
    case &#39;CHANGE_KIND_LIST&#39;:
      return &#123; ...state, kindList: payload &#125;
    default:
      return state
  &#125;
&#125;

export default reducer
</code></pre><blockquote><p>整合多个reducer 为一个，因为 有一个原则 ： 单一数据源 的原则</p></blockquote><p><code>src/15_redux_react-redux_combine/store/index.js</code></p><pre><code class="js">import &#123; combineReducers, createStore &#125; from &#39;redux&#39;
import home from &#39;./modules/home&#39;
import kind from &#39;./modules/kind&#39;

const reducer = combineReducers(&#123;
  home,
  kind
&#125;)

const store = createStore(reducer)

export default store
</code></pre><blockquote><p>入口文件处引入状态管理器</p></blockquote><p><code>src/index.js</code></p><pre><code class="js">// src/index.js
import React from &#39;react&#39;
import ReactDOM from &#39;react-dom/client&#39;

// 引入状态管理器
import &#123; Provider &#125; from &#39;react-redux&#39; // 提供Provier组件，可以添加store属性
import store from &#39;./15_redux_react-redux_combine/store/index&#39;
import App from &#39;./15_redux_react-redux_combine/App&#39;

const root = ReactDOM.createRoot(document.getElementById(&#39;root&#39;))

// 标签形式调用
root.render(
  &lt;Provider store = &#123; store &#125;&gt;
    &lt;App/&gt;
  &lt;/Provider&gt;
)
</code></pre><blockquote><p>组件中使用状态管理器</p></blockquote><p><code>src/15_redux_react-redux_combine/App.jsx</code></p><pre><code class="jsx">import React from &#39;react&#39;;
import Home from &#39;./views/Home&#39;
import Kind from &#39;./views/Kind&#39;
const App = () =&gt; &#123;
  return (
    &lt;div&gt;
      &lt;Home /&gt;

      &lt;hr&gt;&lt;/hr&gt;

      &lt;Kind /&gt;
    &lt;/div&gt;
  );
&#125;;

export default App;
</code></pre><p><code>src/15_redux_react-redux_combine/views/Home.jsx</code> 业务逻辑在展示型组件中</p><pre><code class="jsx">import React, &#123; useEffect &#125; from &#39;react&#39;;
import &#123; connect &#125; from &#39;react-redux&#39;
const Home = (&#123; bannerList, proList, dispatch &#125;) =&gt; &#123;

  useEffect(() =&gt; &#123;
    fetch(&#39;http://121.89.205.189:3001/api/banner/list&#39;).then(res =&gt; res.json()).then(res =&gt; &#123;
      dispatch(&#123;
        type: &#39;CHANGE_BANNER_LIST&#39;,
        payload: res.data
      &#125;)
    &#125;)
    fetch(&#39;http://121.89.205.189:3001/api/pro/list&#39;).then(res =&gt; res.json()).then(res =&gt; &#123;
      dispatch(&#123;
        type: &#39;CHANGE_PRO_LIST&#39;,
        payload: res.data
      &#125;)
    &#125;)
  &#125;, [dispatch])
  return (
    &lt;div&gt;
      &lt;h1&gt;Home&lt;/h1&gt;
      &lt;div&gt;
        &#123; 
          bannerList &amp;&amp; bannerList.map(item =&gt; (
            &lt;img key = &#123; item.bannerid &#125; src=&#123; item.img &#125; alt=&#123;item.alt&#125; style=&#123;&#123; height: 100 &#125;&#125; /&gt;
          ))
        &#125;
      &lt;/div&gt;
      &lt;ul&gt;
        &#123;
          proList &amp;&amp; proList.map(item =&gt; &#123;
            return (&lt;li key = &#123; item.proid &#125;&gt;&#123; item.proname &#125;&lt;/li&gt;)
          &#125;)
        &#125;
      &lt;/ul&gt;
    &lt;/div&gt;
  );
&#125;;

export default connect(
  // (state) =&gt; (&#123; bannerList: state.home.bannerList, proList: state.home.proList &#125;)
  // (&#123; home &#125;) =&gt; (&#123; bannerList: home.bannerList, proList: home.proList &#125;)
  // (&#123; home: &#123; bannerList, proList &#125; &#125;) =&gt; (&#123; bannerList: bannerList, proList: proList &#125;)
  (&#123; home: &#123; bannerList, proList &#125; &#125;) =&gt; (&#123; bannerList, proList &#125;)
)(Home);
</code></pre><p><code>src/15_redux_react-redux_combine/views/Kind.jsx</code> 业务逻辑在容器组件中</p><pre><code class="jsx">import React from &#39;react&#39;;
import &#123; useEffect &#125; from &#39;react&#39;;
import &#123; connect &#125; from &#39;react-redux&#39;
// const Kind = connect(
//   (&#123; kind: &#123; kindList &#125;&#125;) =&gt; (&#123; kindList &#125;), // state =&gt; &#123; return &#123; kindList: state.kind.kindList &#125;&#125;
//   (dispatch) =&gt; (&#123;
//     getKindListData () &#123;
//       fetch(&#39;http://121.89.205.189:3001/api/pro/categorylist&#39;).then(res =&gt; res.json()).then(res =&gt; &#123;
//         dispatch(&#123;
//           type: &#39;CHANGE_KIND_LIST&#39;,
//           payload: res.data
//         &#125;)
//       &#125;)
//     &#125;
//   &#125;)
// )((&#123; kindList, getKindListData &#125;) =&gt; &#123;
//   useEffect(() =&gt; &#123;
//     getKindListData()
//   &#125;, [getKindListData])
//   return (
//     &lt;div&gt;
//       &lt;h1&gt;Kind&lt;/h1&gt;
//       &#123;
//         kindList &amp;&amp; kindList.map(item =&gt; &#123;
//           return (
//             &lt;p key = &#123; item &#125;&gt; &#123; item &#125; &lt;/p&gt;
//           )
//         &#125;)
//       &#125;
//     &lt;/div&gt;
//   );
// &#125;);
// export default Kind;
const Kind = (&#123; kindList, getKindListData &#125;) =&gt; &#123;
  useEffect(() =&gt; &#123;
    getKindListData()
  &#125;, [getKindListData])
  return (
    &lt;div&gt;
      &lt;h1&gt;Kind&lt;/h1&gt;
      &#123;
        kindList &amp;&amp; kindList.map(item =&gt; &#123;
          return (
            &lt;p key = &#123; item &#125;&gt; &#123; item &#125; &lt;/p&gt;
          )
        &#125;)
      &#125;
    &lt;/div&gt;
  );
&#125;;
export default connect(
  (&#123; kind: &#123; kindList &#125;&#125;) =&gt; (&#123; kindList &#125;), // state =&gt; &#123; return &#123; kindList: state.kind.kindList &#125;&#125;
  (dispatch) =&gt; (&#123;
    getKindListData () &#123;
      fetch(&#39;http://121.89.205.189:3001/api/pro/categorylist&#39;).then(res =&gt; res.json()).then(res =&gt; &#123;
        dispatch(&#123;
          type: &#39;CHANGE_KIND_LIST&#39;,
          payload: res.data
        &#125;)
      &#125;)
    &#125;
  &#125;)
)(Kind);
</code></pre><blockquote><p>细心的你发现，虽然展示组件的代码变少了，但是容器组件中还有 异步相关操作，能否把这些异步操作提取出去</p></blockquote><h2 id="18-6-redux-react-redux-分模块-异步操作"><a href="#18-6-redux-react-redux-分模块-异步操作" class="headerlink" title="18.6 redux + react-redux + 分模块+ 异步操作"></a>18.6 redux + react-redux + 分模块+ 异步操作</h2><blockquote><p>配合redux 常用的异步模块 为 <code>redux-thunk</code>, <code>redux-saga</code></p></blockquote><h3 id="18-6-1-redux-thunk"><a href="#18-6-1-redux-thunk" class="headerlink" title="18.6.1 redux-thunk"></a>18.6.1 redux-thunk</h3><pre><code class="sh">$ cnpm i redux-thunk -S
</code></pre><p><code>src/16_redux_react-redux_redux-thunk_combine/store/modules/home.js</code></p><pre><code class="js">const reducer = (
  state = &#123;
    bannerList: [],
    proList: []
  &#125;,
  &#123; type, payload &#125;
) =&gt; &#123;
  switch (type) &#123;
    case &#39;CHANGE_BANNER_LIST&#39;:
      return &#123; ...state, bannerList: payload &#125;
    case &#39;CHANGE_PRO_LIST&#39;:
      return &#123; ...state, proList: payload &#125;
    default:
      return state
  &#125;
&#125;

export default reducer
</code></pre><p><code>src/16_redux_react-redux_redux-thunk_combine/store/modules/kind.js</code></p><pre><code class="js">const reducer = (
  state = &#123;
    kindList: []
  &#125;,
  &#123; type, payload &#125;
) =&gt; &#123;
  switch (type) &#123;
    case &#39;CHANGE_KIND_LIST&#39;:
      return &#123; ...state, kindList: payload &#125;
    default:
      return state
  &#125;
&#125;

export default reducer
</code></pre><blockquote><p>整合多个reducer 为一个，因为 有一个原则 ： 单一数据源 的原则</p><p>并且后续需要使用 异步操作，将异步操作模块 使用进来</p></blockquote><p><code>src/16_redux_react-redux_redux-thunk_combine/store/index.js</code></p><pre><code class="jsx">import &#123; createStore, combineReducers, applyMiddleware &#125; from &#39;redux&#39;
import thunk from &#39;redux-thunk&#39;

import home from &#39;./modules/home&#39;
import kind from &#39;./modules/kind&#39;

const reducer = combineReducers(&#123;
  home,
  kind
&#125;)

// 第二个参数表示代码中含有异步操作，且异步操作需要提取出 容器组件
const store = createStore(reducer, applyMiddleware(thunk))

export default store
</code></pre><p><code>src/index.js</code></p><pre><code class="jsx">// src/index.js
import React from &#39;react&#39;
import ReactDOM from &#39;react-dom/client&#39;

// 引入状态管理器
import &#123; Provider &#125; from &#39;react-redux&#39; // 提供Provier组件，可以添加store属性
import store from &#39;./16_redux_react-redux_redux-thunk_combine/store&#39;
import App from &#39;./16_redux_react-redux_redux-thunk_combine/App&#39;

const root = ReactDOM.createRoot(document.getElementById(&#39;root&#39;))

// 标签形式调用
root.render(
  &lt;Provider store = &#123; store &#125;&gt;
    &lt;App/&gt;
  &lt;/Provider&gt;
)
</code></pre><p><code>src/16_redux_react-redux_redux-thunk_combine/App.jsx</code></p><pre><code class="jsx">import React from &#39;react&#39;;
import Home from &#39;./views/Home&#39;
import Kind from &#39;./views/Kind&#39;
const App = () =&gt; &#123;
  return (
    &lt;div&gt;
      &lt;Home /&gt;
      &lt;hr /&gt;
      &lt;Kind /&gt;
    &lt;/div&gt;
  );
&#125;;

export default App;
</code></pre><blockquote><p>上一个案例 异步操作在组件，现在需要将其放到 异步操作模块中去 actionCreator</p></blockquote><p><code>src/16_redux_react-redux_redux-thunk_combine/api/home.js</code></p><pre><code class="js">export function getBannerList () &#123;
  return fetch(&#39;http://121.89.205.189:3001/api/banner/list&#39;).then(res =&gt; res.json())
&#125;

export function getProList (params) &#123;
  return fetch(&#39;http://121.89.205.189:3001/api/pro/list?limitNum=&#39; + params.limitNum).then(res =&gt; res.json())
&#125;
</code></pre><p><code>src/16_redux_react-redux_redux-thunk_combine/api/kind.js</code></p><pre><code class="js">export function getKindList () &#123;
  return fetch(&#39;http://121.89.205.189:3001/api/pro/categorylist&#39;).then(res =&gt; res.json())
&#125;
</code></pre><p><code>src/16_redux_react-redux_redux-thunk_combine/store/actions/home.js</code></p><pre><code class="js">// 容器组件抽离的异步操作都写在这里
// 每一个action的函数记住一个原则，默认的参数为dispatch
// 如果接口调用不需要传递参数，直接给函数写默认参数 dispatch
// 如果接口调用需要传递参数，一般在返回一个函数，返回函数的 参数为 dispatch
import &#123; getBannerList, getProList &#125; from &#39;../../api/home&#39;

// actionCreator 本质是一个带有 dispatch 参数的函数
const action = &#123;
  getBannerListAction (dispatch) &#123; // 因为此接口不需要参数，所有拥有了默认参数 dispatch
    getBannerList().then(res =&gt; &#123;
      dispatch(&#123;
        type: &#39;CHANGE_BANNER_LIST&#39;,
        payload: res.data
      &#125;)
    &#125;)
  &#125;,
  getProListAction (params) &#123; // 组件调用需要传递参数
    return (dispatch) =&gt; &#123;
      getProList(params).then(res =&gt; &#123;
        dispatch(&#123;
          type: &#39;CHANGE_PRO_LIST&#39;,
          payload: res.data
        &#125;)
      &#125;)
    &#125;
  &#125;
&#125;

export default action
</code></pre><p><code>src/16_redux_react-redux_redux-thunk_combine/store/actions/kind.js</code></p><pre><code class="jsx">import &#123; getKindList &#125; from &#39;../../api/kind&#39;

const action = &#123;
  getKindListAction (dispatch) &#123;
    getKindList().then(res =&gt; &#123;
      dispatch(&#123;
        type: &#39;CHANGE_KIND_LIST&#39;,
        payload: res.data
      &#125;)
    &#125;)
  &#125;
&#125;

export default action 
</code></pre><blockquote><p>记住接口有无参数影响 action 的写法，还影响其调用</p></blockquote><p><code>src/16_redux_react-redux_redux-thunk_combine/views/Home.jsx</code></p><pre><code class="jsx">import React from &#39;react&#39;;
import &#123; useEffect &#125; from &#39;react&#39;;
import &#123; connect &#125; from &#39;react-redux&#39;

import action from &#39;../store/actions/home&#39;
const Home = connect((state) =&gt; &#123;
  return &#123;
    bannerList: state.home.bannerList,
    proList: state.home.proList
  &#125;
&#125;, (dispatch) =&gt; &#123;
  return &#123;
    getBannerList () &#123;
      dispatch(action.getBannerListAction) // 因为没有参数，所以不加()
    &#125;,
    getProList () &#123;
      dispatch(action.getProListAction(&#123; count: 2, limitNum: 3 &#125;))  // 因为有参数，所以加()
    &#125;
  &#125;
&#125;)((&#123; bannerList, proList, getBannerList, getProList &#125;) =&gt; &#123;
  useEffect(() =&gt; &#123;
    getBannerList()
    getProList()
  &#125;, [getBannerList, getProList])
  return (
    &lt;div&gt;
      &lt;h1&gt;首页&lt;/h1&gt;
      &lt;ul&gt;
        &#123;
          bannerList &amp;&amp; bannerList.map(item =&gt; (
            &lt;img src = &#123; item.img &#125; key = &#123; item.bannerid &#125; alt=&quot;&quot; style=&#123;&#123; height: 60 &#125;&#125;&gt;&lt;/img&gt;
          ))
        &#125;
      &lt;/ul&gt;

      &lt;ul&gt;
        &#123;
          proList &amp;&amp; proList.map(item =&gt; (
            &lt;li key = &#123; item.proid &#125;&gt;&#123; item.proname &#125;&lt;/li&gt;
          ))
        &#125;
      &lt;/ul&gt;
    &lt;/div&gt;
  );
&#125;);

export default Home;
</code></pre><p><code>src/16_redux_react-redux_redux-thunk_combine/views/Home.jsx</code> 异步在组件</p><pre><code class="jsx">import React, &#123; useEffect &#125; from &#39;react&#39;;
import &#123; connect &#125; from &#39;react-redux&#39;
// import &#123; getBannerList, getProList &#125; from &#39;../api/home&#39;
import action from &#39;../store/actions/home&#39; // 异步操作
const Home = (&#123; bannerList, proList, getBannerListData, getProListData &#125;) =&gt; &#123;
  useEffect(() =&gt; &#123;
    getBannerListData()
    getProListData()
  &#125;, [getBannerListData, getProListData])
  return (
    &lt;div&gt;
      &lt;h1&gt;Home&lt;/h1&gt;
      &lt;div&gt;
        &#123; 
          bannerList &amp;&amp; bannerList.map(item =&gt; (
            &lt;img key = &#123; item.bannerid &#125; src=&#123; item.img &#125; alt=&#123;item.alt&#125; style=&#123;&#123; height: 100 &#125;&#125; /&gt;
          ))
        &#125;
      &lt;/div&gt;
      &lt;ul&gt;
        &#123;
          proList &amp;&amp; proList.map(item =&gt; &#123;
            return (&lt;li key = &#123; item.proid &#125;&gt;&#123; item.proname &#125;&lt;/li&gt;)
          &#125;)
        &#125;
      &lt;/ul&gt;
    &lt;/div&gt;
  );
&#125;;

export default connect(
  (&#123; home: &#123; bannerList, proList &#125;&#125;) =&gt; (&#123; bannerList, proList &#125;),
  (dispatch) =&gt; (&#123;
    getBannerListData () &#123;
      // getBannerList().then(res =&gt; &#123;
      //   dispatch(&#123;
      //     type: &#39;CHANGE_BANNER_LIST&#39;,
      //     payload: res.data
      //   &#125;)
      // &#125;)
      // 根据生成的actionCreate 规则去写，午餐不加（）
      dispatch(action.getBannerListAction)
      
    &#125;,
    getProListData () &#123;
      // getProList().then(res =&gt; &#123;
      //   dispatch(&#123;
      //     type: &#39;CHANGE_PRO_LIST&#39;,
      //     payload: res.data
      //   &#125;)
      // &#125;)
      dispatch(action.getProListAction(&#123; limitNum: 2 &#125;))
    &#125;
  &#125;)
)(Home);
</code></pre><p><code>src/16_redux_react-redux_redux-thunk_combine/views/Kind.jsx</code> 异步在store</p><pre><code class="jsx">import React, &#123; useEffect &#125; from &#39;react&#39;;
import &#123; connect &#125; from &#39;react-redux&#39;
// import &#123; getKindList &#125; from &#39;../api/kind&#39;
import action from &#39;../store/actions/kind&#39;
const Kind = (&#123; kindList, getKindListData &#125;) =&gt; &#123;
  useEffect(() =&gt; &#123;
    getKindListData()
  &#125;, [getKindListData])
  return (
    &lt;div&gt;
      &lt;h1&gt;Kind&lt;/h1&gt;
      &#123;
        kindList &amp;&amp; kindList.map(item =&gt; &#123;
          return (
            &lt;p key = &#123; item &#125;&gt; &#123; item &#125; &lt;/p&gt;
          )
        &#125;)
      &#125;
    &lt;/div&gt;
  );
&#125;;

export default connect(
  (&#123; kind: &#123; kindList &#125; &#125;) =&gt; (&#123; kindList &#125;),
  (dispatch) =&gt; (&#123;
    getKindListData () &#123;
      // getKindList().then(res =&gt; &#123;
      //   dispatch(&#123;
      //     type: &#39;CHANGE_KIND_LIST&#39;,
      //     payload: res.data
      //   &#125;)
      // &#125;)
      dispatch(action.getKindListAction)
    &#125;
  &#125;)
)(Kind);
</code></pre><blockquote><p>虽然引入了redux-thunk，但是仍然可以把 异步放在组件中，具体根据项目的需求而定</p></blockquote><blockquote><p>创建状态模块</p><p>整合模块</p><p>创建异步的 actionCreator</p><p>组件触发 actionCreator</p><p>传递数据以及修改界面</p></blockquote><h3 id="18-6-2-redux-saga"><a href="#18-6-2-redux-saga" class="headerlink" title="18.6.2 redux-saga"></a>18.6.2 redux-saga</h3><blockquote><p>先要了解解决异步操作方案：回调函数、promise、async await、generator yield</p></blockquote><p><span class="exturl" data-url="aHR0cHM6Ly9lczYucnVhbnlpZmVuZy5jb20vI2RvY3MvZ2VuZXJhdG9yLWFzeW5j">https://es6.ruanyifeng.com/#docs/generator-async</span></p><pre><code class="sh">$ cnpm i redux-saga -S
</code></pre><p><code>src/17_redux_react-redux_redux-saga_combine/store/modules/home.js</code></p><pre><code class="jsx">const reducer =  (state = &#123;
  bannerList: [],
  proList: []
&#125;, &#123; type, payload &#125;) =&gt; &#123;
  switch (type) &#123;
    case &#39;CHANGE_BANNER_LIST&#39;:
      return &#123; ...state, bannerList: payload &#125;
    case &#39;CHANGE_PRO_LIST&#39;:
      return &#123; ...state, proList: payload &#125;
    default:
      return state
  &#125;
&#125;

export default reducer
</code></pre><p><code>src/17_redux_react-redux_redux-saga_combine/store/modules/kind.js</code></p><pre><code class="js">const reducer = (state = &#123;
  kindList: []
&#125;, &#123; type, payload &#125;) =&gt; &#123;
  switch (type) &#123;
    case &#39;CHANGE_KIND_LIST&#39;:
      return &#123; ...state, kindList: payload &#125;
    default:
      return state
  &#125;
&#125;
export default reducer
</code></pre><p><code>src/17_redux_react-redux_redux-saga_combine/api/home.js</code></p><pre><code class="js">export function getBannerList () &#123;
  return fetch(&#39;http://121.89.205.189:3001/api/banner/list&#39;).then(res =&gt; res.json())
&#125;

export function getProList (params) &#123;
  return fetch(&#39;http://121.89.205.189:3001/api/pro/list?limitNum=&#39; + params.limitNum).then(res =&gt; res.json())
&#125;
</code></pre><p><code>src/17_redux_react-redux_redux-saga_combine/api/kind.js</code></p><pre><code class="js">export function getKindList () &#123;
  return fetch(&#39;http://121.89.205.189:3001/api/pro/categorylist&#39;).then(res =&gt; res.json())
&#125;
</code></pre><p><code>src/17_redux_react-redux_redux-saga_combine/store/mySaga.js</code></p><pre><code class="js">// put 类似 dispatch put(&#123; type: &#39;&#39;, payload: &#39;&#39;&#125;) 触发状态的修改
// call 用来调用数据请求   call(getBannerList)  ===&gt;    getBannerList()
// takeLatest 用来响应触发哪一个异步操作
import &#123; put, call, takeLatest &#125; from &#39;redux-saga/effects&#39;

import &#123; getBannerList, getProList &#125; from &#39;../api/home&#39;
import &#123; getKindList &#125; from &#39;../api/kind&#39;

// 异步操作
function * getBannerListAction () &#123;
  const res = yield call(getBannerList)
  console.log(&#39;banner&#39;, res.data)
  // 修改状态
  yield put(&#123;
    type: &#39;CHANGE_BANNER_LIST&#39;,
    payload: res.data
  &#125;)
&#125;

function * getProListAction (action) &#123;
  console.log(111, action)
  const res = yield call(getProList, action.payload)
  console.log(&#39;pro&#39;, res.data)
  yield put(&#123;
    type: &#39;CHANGE_PRO_LIST&#39;,
    payload: res.data
  &#125;)
&#125;

function * getKindListAction () &#123;
  const res = yield call(getKindList)
  console.log(&#39;kind&#39;, res.data)
  yield put(&#123;
    type: &#39;CHANGE_KIND_LIST&#39;,
    payload: res.data
  &#125;)
&#125;

// 定义异步触发的条件
function * mySaga () &#123;
  // 组件触发 REQUEST_BANNER 即可执行 getBannerListAction 异步行为
  yield takeLatest(&#39;REQUEST_BANNER&#39;, getBannerListAction)
  // 组件触发 REQUEST_PRO 即可执行 getProListAction 异步行为
  yield takeLatest(&#39;REQUEST_PRO&#39;, getProListAction)
   // 组件触发 REQUEST_KIND 即可执行 getKindListAction 异步行为
  yield takeLatest(&#39;REQUEST_KIND&#39;, getKindListAction)
&#125;

export default mySaga
</code></pre><p><code>src/17_redux_react-redux_redux-saga_combine/store/index.js</code></p><pre><code class="jsx">import &#123; createStore, combineReducers, applyMiddleware &#125; from &#39;redux&#39;
import createSagaMiddleWare from &#39;redux-saga&#39; // 导入生成中间件的函数

import mySaga from &#39;./mySaga&#39; // 异步行为

// 分模块
import home from &#39;./modules/home&#39;
import kind from &#39;./modules/kind&#39;

const reducer = combineReducers(&#123; home, kind &#125;) // 整合reducer

const middleware = createSagaMiddleWare() // 生成中间件

const store = createStore(reducer, applyMiddleware(middleware)) // 创建状态管理器

middleware.run(mySaga) // 中间件使用异步，放到store创建之后

export default store
</code></pre><p><code>src/index.js</code></p><pre><code class="js">// src/index.js
import React from &#39;react&#39;
import ReactDOM from &#39;react-dom/client&#39;

// 引入状态管理器
import &#123; Provider &#125; from &#39;react-redux&#39; // 提供Provier组件，可以添加store属性
import store from &#39;./17_redux_react-redux_redux-saga_combine/store/index&#39;
import App from &#39;./17_redux_react-redux_redux-saga_combine/App&#39;

const root = ReactDOM.createRoot(document.getElementById(&#39;root&#39;))

// 标签形式调用
root.render(
  &lt;Provider store = &#123; store &#125;&gt;
    &lt;App/&gt;
  &lt;/Provider&gt;
)
</code></pre><p><code>src/17_redux_react-redux_redux-saga_combine/views/Home.jsx</code></p><pre><code class="jsx">import React from &#39;react&#39;;
import &#123; useEffect &#125; from &#39;react&#39;;
import &#123; connect &#125; from &#39;react-redux&#39;
const Home = (&#123; bannerList, proList, dispatch &#125;) =&gt; &#123;
  useEffect(() =&gt; &#123;
    // 触发某个行为，从而触发 异步操作
    dispatch(&#123; type: &#39;REQUEST_BANNER&#39; &#125;)
    dispatch(&#123; type: &#39;REQUEST_PRO&#39;, payload: &#123; limitNum: 3 &#125; &#125;)
  &#125;, [dispatch])
  return (
    &lt;div&gt;
      &lt;h1&gt;Home&lt;/h1&gt;
      &lt;div&gt;
        &#123; 
          bannerList &amp;&amp; bannerList.map(item =&gt; (
            &lt;img key = &#123; item.bannerid &#125; src=&#123; item.img &#125; alt=&#123;item.alt&#125; style=&#123;&#123; height: 100 &#125;&#125; /&gt;
          ))
        &#125;
      &lt;/div&gt;
      &lt;ul&gt;
        &#123;
          proList &amp;&amp; proList.map(item =&gt; &#123;
            return (&lt;li key = &#123; item.proid &#125;&gt;&#123; item.proname &#125;&lt;/li&gt;)
          &#125;)
        &#125;
      &lt;/ul&gt;
    &lt;/div&gt;
  );
&#125;;

export default connect(
  (&#123; home: &#123; bannerList, proList &#125;&#125;) =&gt; (&#123; bannerList, proList &#125;)
)(Home);
</code></pre><p><code>src/17_redux_react-redux_redux-saga_combine/views/Kind.jsx</code></p><pre><code class="jsx">import React, &#123; useEffect &#125; from &#39;react&#39;;
import &#123; connect &#125; from &#39;react-redux&#39;
const Kind = (&#123; kindList, getKindListData &#125;) =&gt; &#123;
  useEffect(() =&gt; &#123;
    getKindListData()
  &#125;, [getKindListData])
  return (
    &lt;div&gt;
      &lt;h1&gt;Kind&lt;/h1&gt;
      &#123;
        kindList &amp;&amp; kindList.map(item =&gt; &#123;
          return (
            &lt;p key = &#123; item &#125;&gt; &#123; item &#125; &lt;/p&gt;
          )
        &#125;)
      &#125;
    &lt;/div&gt;
  );
&#125;;

export default connect(
  (&#123; kind: &#123; kindList &#125;&#125;) =&gt; (&#123;kindList&#125;),
  (dispatch) =&gt; (&#123;
    getKindListData () &#123;
      dispatch(&#123; type: &#39;REQUEST_KIND&#39; &#125;)
    &#125;
  &#125;)
)(Kind);
</code></pre><h2 id="18-7-使用immutable不可变数据数据结构"><a href="#18-7-使用immutable不可变数据数据结构" class="headerlink" title="18.7 使用immutable不可变数据数据结构"></a>18.7 使用immutable不可变数据数据结构</h2><p>immutable不可变的数据解构，意思就是一旦数据被创建，需要使用特殊的方法进行修改（修改过后的数据也是符合immutable数据解构的，他是一个全新的对象）</p><p>学习immutable： <span class="exturl" data-url="aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvaW1tdXRhYmxl">https://www.npmjs.com/package/immutable</span></p><pre><code>$ cnpm i immutable redux-immutable -S
</code></pre><p>重点就是修改 reducer 的数据机构以及组件中获取状态的方式（整合reducer时使用 redux-immutable 提供的 combineReducers）</p><p>拷贝17文件，修改 store&#x2F;modules&#x2F;home.js store&#x2F;modules&#x2F;kind.js store&#x2F;index.js</p><p>views&#x2F;Home.jsx views&#x2F;Kind.jsx</p><h1 id="十九、redux-toolkit"><a href="#十九、redux-toolkit" class="headerlink" title="十九、redux toolkit"></a>十九、redux toolkit</h1><p><span class="exturl" data-url="aHR0cHM6Ly9jbi5yZWR1eC5qcy5vcmcv">https://cn.redux.js.org/</span></p><h2 id="19-1-什么是Redux-Toolkit"><a href="#19-1-什么是Redux-Toolkit" class="headerlink" title="19.1 什么是Redux Toolkit"></a>19.1 什么是Redux Toolkit</h2><p><span class="exturl" data-url="aHR0cHM6Ly9jbi5yZWR1eC5qcy5vcmcvcmVkdXgtdG9vbGtpdC9vdmVydmlldy8=">https://cn.redux.js.org/redux-toolkit/overview/</span></p><p><strong><span class="exturl" data-url="aHR0cHM6Ly9yZWR1eC10b29sa2l0LmpzLm9yZy8=">Redux Toolkit</span></strong> 是我们官方的，有观点的，开箱即用的高效 Redux 开发工具集。它旨在成为标准的 Redux 逻辑开发方式，我们强烈建议您使用它。</p><p>它包括几个实用程序功能，这些功能可以简化最常见场景下的 Redux 开发，包括配置 store、定义 reducer，不可变的更新逻辑、甚至可以立即创建整个状态的 “切片 slice”，而无需手动编写任何 action creator 或者 action type。它还包括使用最广泛的 Redux 插件，例如 Redux Thunk 用于异步逻辑，而 Reselect 用于编写选择器 selector 函数，因此你可以立即使用它们。</p><h2 id="19-2-如何使用redux-toolkit"><a href="#19-2-如何使用redux-toolkit" class="headerlink" title="19.2 如何使用redux-toolkit"></a>19.2 如何使用redux-toolkit</h2><p><span class="exturl" data-url="aHR0cHM6Ly9jbi5yZWR1eC5qcy5vcmcvdHV0b3JpYWxzL3F1aWNrLXN0YXJ0">https://cn.redux.js.org/tutorials/quick-start</span></p><pre><code class="sh">$ cnpm i @reduxjs/toolkit redux react-redux redux-devtools -S
</code></pre><h3 id="19-2-1-创建状态管理器"><a href="#19-2-1-创建状态管理器" class="headerlink" title="19.2.1 创建状态管理器"></a>19.2.1 创建状态管理器</h3><p><code>src/19_rtk/store/index.js</code></p><pre><code class="js">import &#123; configureStore &#125; from &#39;@reduxjs/toolkit&#39;

const store = configureStore(&#123;
  reducer: &#123; // 此处可以设置多模块

  &#125;
&#125;)

export default store
</code></pre><h3 id="19-2-2-入口文件配置状态管理器"><a href="#19-2-2-入口文件配置状态管理器" class="headerlink" title="19.2.2 入口文件配置状态管理器"></a>19.2.2 入口文件配置状态管理器</h3><p><code>src/index.js</code></p><pre><code class="js">// src/index.js
import React from &#39;react&#39;
import ReactDOM from &#39;react-dom/client&#39;

// 引入状态管理器
import &#123; Provider &#125; from &#39;react-redux&#39; // 提供Provier组件，可以添加store属性
import store from &#39;./19_rtk/store&#39;
import App from &#39;./19_rtk/App&#39;

const root = ReactDOM.createRoot(document.getElementById(&#39;root&#39;))

// 标签形式调用
root.render(
  &lt;Provider store = &#123; store &#125;&gt;
    &lt;App/&gt;
  &lt;/Provider&gt;
)
</code></pre><h3 id="19-2-3-创建分模块切片"><a href="#19-2-3-创建分模块切片" class="headerlink" title="19.2.3 创建分模块切片"></a>19.2.3 创建分模块切片</h3><p>创建 slice 需要一个字符串名称来标识切片、一个初始 state 以及一个或多个定义了该如何更新 state 的 reducer 函数。slice 创建后 ，我们可以导出 slice 中生成的 Redux action creators 和 reducer 函数。</p><p><code>src/19_rtk/store/modules/home.js</code></p><pre><code class="js">import &#123; createSlice &#125; from &#39;@reduxjs/toolkit&#39;
// 创建 slice 需要一个字符串名称来标识切片、一个初始 state 以及一个或多个定义了该如何更新 state 的 reducer 函数。
// slice 创建后 ，我们可以导出 slice 中生成的 Redux action creators 和 reducer 函数。
export const homeSlice = createSlice(&#123;
  name: &#39;home&#39;, // vuex namespaced: true
  initialState: &#123; // vuex state
    bannerList: [],
    proList: []
  &#125;,
  reducers: &#123; // vuex mutations
    changeBannerList (state, action) &#123;
      state.bannerList = action.payload
    &#125;,
    changeProList (state, action) &#123;
      state.proList = action.payload
    &#125;
  &#125;
&#125;)
console.log(&#39;home&#39;, homeSlice)
// 每个 case reducer 函数会生成对应的 Action creators
export const &#123; changeBannerList, changeProList &#125; = homeSlice.actions

export default homeSlice.reducer // redux时 管理状态都是 reducer
</code></pre><p><code>src/19_rtk/store/modules/kind.js</code></p><pre><code class="js">import &#123; createSlice &#125; from &#39;@reduxjs/toolkit&#39;

export const kindSlice = createSlice(&#123;
  name: &#39;kind&#39;,
  initialState: &#123;
    kindList: []
  &#125;,
  reducers: &#123;
    changeKindList (state, action) &#123;
      state.kindList = action.payload
    &#125;
  &#125;
&#125;)

export const &#123; changeKindList &#125; = kindSlice.actions

export default kindSlice.reducer
</code></pre><h3 id="19-2-4-整合切片"><a href="#19-2-4-整合切片" class="headerlink" title="19.2.4 整合切片"></a>19.2.4 <strong>整合切片</strong></h3><p><code>src/19_rtk/store/index.js</code></p><pre><code class="js">import &#123; configureStore &#125; from &#39;@reduxjs/toolkit&#39;
import home from &#39;./modules/home&#39;
import kind from &#39;./modules/kind&#39;
const store = configureStore(&#123;
  reducer: &#123; // 所有的模块都可以配置到此
    home, kind
  &#125;
&#125;)

export default store
</code></pre><h3 id="19-2-5-组件中使用状态管理器"><a href="#19-2-5-组件中使用状态管理器" class="headerlink" title="19.2.5 组件中使用状态管理器"></a>19.2.5 组件中使用状态管理器</h3><p><code>src/19_rtk/views/Home.jsx</code></p><pre><code class="jsx">import React, &#123; useEffect &#125; from &#39;react&#39;;
// useSelector 用来获取状态管理器的状态
// useDispatch 用来修改状态
import &#123; useSelector, useDispatch &#125; from &#39;react-redux&#39;

import &#123; changeBannerList, changeProList &#125; from &#39;./../store/modules/home&#39;
import &#123; getBannerList, getProList  &#125; from &#39;../api/home&#39;
const Home = () =&gt; &#123;
  const bannerList = useSelector(state =&gt; state.home.bannerList)
  const proList = useSelector(state =&gt; state.home.proList)
  const dispatch = useDispatch()
  useEffect(() =&gt; &#123;
    getBannerList().then(res =&gt; &#123; 
      dispatch(changeBannerList(res.data))
    &#125;)
    getProList(&#123; limitNum: 5 &#125;).then(res =&gt; &#123; 
      dispatch(changeProList(res.data))
    &#125;)
  &#125;, [dispatch])
  return (
    &lt;div&gt;
      &lt;h1&gt;Home&lt;/h1&gt;
      &lt;div&gt;
        &#123; 
          bannerList &amp;&amp; bannerList.map(item =&gt; (
            &lt;img key = &#123; item.bannerid &#125; src=&#123; item.img &#125; alt=&#123;item.alt&#125; style=&#123;&#123; height: 100 &#125;&#125; /&gt;
          ))
        &#125;
      &lt;/div&gt;
      &lt;ul&gt;
        &#123;
          proList &amp;&amp; proList.map(item =&gt; &#123;
            return (&lt;li key = &#123; item.proid &#125;&gt;&#123; item.proname &#125;&lt;/li&gt;)
          &#125;)
        &#125;
      &lt;/ul&gt;
    &lt;/div&gt;
  );
&#125;;

export default Home;
</code></pre><p><code>src/19_rtk/views/Kind.jsx</code></p><pre><code class="jsx">import React from &#39;react&#39;;
import &#123; useEffect &#125; from &#39;react&#39;;
import &#123; useDispatch, useSelector &#125; from &#39;react-redux&#39;
import &#123; getKindList &#125; from &#39;../api/kind&#39;
import &#123; changeKindList &#125; from &#39;../store/modules/kind&#39;
const Kind = () =&gt; &#123;
  const kindList = useSelector(state =&gt; state.kind.kindList)

  const dispatch = useDispatch()

  useEffect(() =&gt; &#123;
    getKindList().then(res =&gt; &#123;
      dispatch(changeKindList(res.data))
    &#125;)
  &#125;, [dispatch])
  return (
    &lt;div&gt;
      &lt;h1&gt;Kind&lt;/h1&gt;
      &#123;
        kindList &amp;&amp; kindList.map(item =&gt; &#123;
          return (
            &lt;p key = &#123; item &#125;&gt; &#123; item &#125; &lt;/p&gt;
          )
        &#125;)
      &#125;
    &lt;/div&gt;
  );
&#125;;

export default Kind;
</code></pre><blockquote><ul><li><p>使用<code>configureStore</code>创建 Redux store</p><ul><li><code>configureStore</code> 接受 <code>reducer</code> 函数作为命名参数</li><li><code>configureStore</code> 使用的好用的默认设置自动设置 store</li></ul></li><li><p>为 React 应用程序组件提供 Redux store</p><ul><li>使用 React-Redux <code>&lt;Provider&gt;</code> 组件包裹你的 <code>&lt;App /&gt;</code></li><li>传递 Redux store 如 <code>&lt;Provider store=&#123;store&#125;&gt;</code></li></ul></li><li><p>使用 <code>createSlice</code> 创建 Redux “slice” reducer</p><ul><li><p>使用字符串名称、初始状态和命名的 reducers 函数调用“createSlice”</p></li><li><p>Reducer 函数可以使用 Immer 来“改变”状态</p></li><li><p>导出生成的 slice reducer 和 action creators</p></li></ul></li><li><p>在 React 组件中使用 React-Redux <code>useSelector/useDispatch</code> 钩子</p><ul><li><p>使用 <code>useSelector</code> 钩子从 store 中读取数据</p></li><li><p>使用 <code>useDispatch</code> 钩子获取 <code>dispatch</code> 函数，并根据需要 dispatch actions</p></li></ul></li></ul></blockquote><blockquote><p>此时发现，组件中的异步操作在 组件内部调用，接下来需要研究如何将异步操作从组件提取出来</p></blockquote><h2 id="19-3-提取异步操作"><a href="#19-3-提取异步操作" class="headerlink" title="19.3 提取异步操作"></a>19.3 提取异步操作</h2><h3 id="19-3-1-自己定义请求函数"><a href="#19-3-1-自己定义请求函数" class="headerlink" title="19.3.1 自己定义请求函数"></a>19.3.1 自己定义请求函数</h3><p><code>src/20_rtk_async/api/home.js</code></p><pre><code class="js">export function getBannerList () &#123;
  return fetch(&#39;http://121.89.205.189:3001/api/banner/list&#39;).then(res =&gt; res.json())
&#125;

export function getProList (params) &#123;
  return fetch(&#39;http://121.89.205.189:3001/api/pro/list?limitNum=&#39; + params.limitNum).then(res =&gt; res.json())
&#125;
</code></pre><p><code>src/20_rtk_async/api/kind.js</code></p><pre><code class="js">export function getKindList () &#123;
  return fetch(&#39;http://121.89.205.189:3001/api/pro/categorylist&#39;).then(res =&gt; res.json())
&#125;
</code></pre><p><code>src/20_rtk_async/store/modules/home.js</code></p><pre><code class="js">import &#123; createSlice &#125; from &#39;@reduxjs/toolkit&#39;
import &#123; getBannerList, getProList &#125; from &#39;../../api/home&#39;
export const homeSlice = createSlice(&#123; // 主要定义模块，后期从模块中取值给组件以及整合状态管理器
  name: &#39;home&#39;, // 模块名称
  initialState: &#123; // 模块代表的初始化状态
    bannerList: [],
    proList: []
  &#125;,
  reducers: &#123; // 修改状态
    changeBannerList (state, action) &#123;
      state.bannerList = action.payload
    &#125;,
    changeProList (state, action) &#123;
      state.proList = action.payload
    &#125;
  &#125;
&#125;)
// 取得数据之后，只需要 dispatch 触发此函数即可，参数即为修改时用的action的值
export const &#123; changeBannerList, changeProList &#125; = homeSlice.actions
// 如果异步操作在状态管理器，写如下代码，参照 redux-thunk 写法
export function getBannerListAction (dispatch) &#123; // dispatch 为默认参数
  getBannerList().then(res =&gt; &#123;
    dispatch(changeBannerList(res.data))
  &#125;)
&#125;
export function getProListAction (params) &#123;
  return (dispatch) =&gt; &#123; // dispatch 为默认参数
    getProList(params).then(res =&gt; &#123;
      dispatch(changeProList(res.data))
    &#125;)
  &#125;
&#125;
export default homeSlice.reducer
</code></pre><p><code>src/20_rtk_async/store/index.js</code></p><pre><code class="js">import &#123; configureStore &#125; from &#39;@reduxjs/toolkit&#39;
import home from &#39;./modules/home&#39;

const store = configureStore(&#123;
  reducer: &#123;
    home
  &#125;
&#125;)

export default store
</code></pre><p><code>src/index.js</code></p><pre><code class="js">// src/index.js
import React from &#39;react&#39;
import ReactDOM from &#39;react-dom/client&#39;

// 引入状态管理器
import &#123; Provider &#125; from &#39;react-redux&#39; // 提供Provier组件，可以添加store属性
import store from &#39;./20_rtk_async/store&#39;
import App from &#39;./20_rtk_async/App&#39;

const root = ReactDOM.createRoot(document.getElementById(&#39;root&#39;))

// 标签形式调用
root.render(
  &lt;Provider store = &#123; store &#125;&gt;
    &lt;App/&gt;
  &lt;/Provider&gt;
)
</code></pre><p><code>src/20_rtk_async/App.jsx</code></p><pre><code class="jsx">import React from &#39;react&#39;;
import Home from &#39;./views/Home&#39;;
import Kind from &#39;./views/Kind&#39;;

const App = () =&gt; &#123;
  return (
    &lt;div&gt;
      &lt;Home /&gt;
      &lt;hr /&gt;
      &lt;Kind /&gt;
    &lt;/div&gt;
  );
&#125;;

export default App;
</code></pre><p><code>src/20_rtk_async/views/Home.jsx</code></p><pre><code class="jsx">import React, &#123; useEffect &#125; from &#39;react&#39;;
import &#123; useDispatch, useSelector &#125; from &#39;react-redux&#39;
import &#123; getBannerListAction, getProListAction &#125; from &#39;../store/modules/home&#39;

const Home = () =&gt; &#123;
  const bannerList = useSelector(state =&gt; state.home.bannerList)
  const proList = useSelector(state =&gt; state.home.proList)

  const dispatch = useDispatch()

  useEffect(() =&gt; &#123;
    dispatch(getBannerListAction) // 无参不加（）
    dispatch(getProListAction(&#123; limitNum: 8 &#125;)) // 有参加（）
  &#125;, [dispatch])
  return (
    &lt;div&gt;
      &lt;h1&gt;Home20&lt;/h1&gt;
      &lt;div&gt;
        &#123; 
          bannerList &amp;&amp; bannerList.map(item =&gt; (
            &lt;img key = &#123; item.bannerid &#125; src=&#123; item.img &#125; alt=&#123;item.alt&#125; style=&#123;&#123; height: 100 &#125;&#125; /&gt;
          ))
        &#125;
      &lt;/div&gt;
      &lt;ul&gt;
        &#123;
          proList &amp;&amp; proList.map(item =&gt; &#123;
            return (&lt;li key = &#123; item.proid &#125;&gt;&#123; item.proname &#125;&lt;/li&gt;)
          &#125;)
        &#125;
      &lt;/ul&gt;
    &lt;/div&gt;
  );
&#125;;

export default Home;
</code></pre><h3 id="19-3-2-使用-createAsyncThunk-请求数据"><a href="#19-3-2-使用-createAsyncThunk-请求数据" class="headerlink" title="19.3.2 使用 createAsyncThunk 请求数据"></a>19.3.2 使用 <code>createAsyncThunk</code> 请求数据</h3><p>Redux Toolkit 的 <code>createAsyncThunk</code> API 生成 thunk，为您自动 dispatch 那些 “start&#x2F;success&#x2F;failure” action。</p><p><code>src/20_rtk_async/store/modules/kind.js</code></p><pre><code class="js">import &#123; createSlice, createAsyncThunk &#125; from &#39;@reduxjs/toolkit&#39;
import &#123; getKindList &#125; from &#39;./../../api//kind&#39;
export const kindSlice = createSlice(&#123;
  name: &#39;kind&#39;,
  initialState: &#123;
    kindList: []
  &#125;,
  reducers: &#123;
    changeKindList (state, action) &#123; // 如果使用了 createAsyncThunk 此处修改状态失效
      state.kindList = action.payload
    &#125;
  &#125;,
  extraReducers: (builder) =&gt; &#123; // createAsyncThunk 在这里修改状态 下面可以看作固定的写法
    builder
      .addCase(getKindListAction.pending, state =&gt; &#123;
        state.status = &#39;loading&#39;
      &#125;)
      .addCase(getKindListAction.fulfilled, (state, action) =&gt; &#123;
        state.status = &#39;idle&#39;
        state.kindList = action.payload
      &#125;)
      .addCase(getKindListAction.rejected, state =&gt; &#123;
        state.status = &#39;failed&#39;
      &#125;)
      
    &#125;
&#125;)

// kind/getKindListAction1123 可以自定义，但是最好有意义
export const getKindListAction = createAsyncThunk(&#39;kind/getKindListAction1123&#39;, async (num) =&gt; &#123;
  console.log(&#39;num&#39;, num)
  const res = await getKindList()
  return res.data
&#125;)

export const &#123; changeKindList &#125; = kindSlice.actions

export default kindSlice.reducer
</code></pre><p><code>src/20_rtk_async/views/Kind.jsx</code></p><pre><code class="jsx">import React from &#39;react&#39;;
import &#123; useEffect &#125; from &#39;react&#39;;
import &#123; useDispatch, useSelector &#125; from &#39;react-redux&#39;
import &#123; getKindListAction &#125; from &#39;../store/modules/kind&#39;
const Kind = () =&gt; &#123;
  const kindList = useSelector(state =&gt; state.kind.kindList)
  const dispatch = useDispatch()
  useEffect(() =&gt; &#123;
    dispatch(getKindListAction(1000000))
  &#125;, [dispatch])
  return (
    &lt;div&gt;
      &lt;h1&gt;Kind20&lt;/h1&gt;
      &#123;
        kindList &amp;&amp; kindList.map(item =&gt; &#123;
          return (
            &lt;p key = &#123; item &#125;&gt; &#123; item &#125; &lt;/p&gt;
          )
        &#125;)
      &#125;
    &lt;/div&gt;
  );
&#125;;

export default Kind;
</code></pre><div class="tags"><a href="/tags/react/" rel="tag"><i class="ic i-tag"></i> react</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-10-31 10:21:23" itemprop="dateModified" datetime="2022-10-31T10:21:23+08:00">2022-10-31</time> </span><span id="react-study/8/" class="item leancloud_visitors" data-flag-title="React学习第八天" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 联系我</button><p>来交朋友吧！</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="叶星辰 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="叶星辰 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="叶星辰 QQ"><p>QQ</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>叶星辰 <i class="ic i-at"><em>@</em></i>永不陨落的星辰</li><li class="link"><strong>本文链接：</strong> <a href="https://www.yexingcheng.com/react-study/8/" title="React学习第八天">https://www.yexingcheng.com/react-study/8/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/react-study/7/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gicli9lfebj20zk0m84qp.jpg" title="React学习第七天"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> react学习</span><h3>React学习第七天</h3></a></div><div class="item right"><a href="/interview/programming/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipet8c1a2j20zk0m8kct.jpg" title="编程题总结"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 面试用</span><h3>编程题总结</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E5%85%AB%E3%80%81Redux"><span class="toc-number">1.</span> <span class="toc-text">十八、Redux</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#18-1-%E7%90%86%E8%A7%A3Flux%E6%9E%B6%E6%9E%84"><span class="toc-number">1.1.</span> <span class="toc-text">18.1 理解Flux架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-2-%E7%90%86%E8%A7%A3Redux%E5%8D%95%E5%90%91%E6%95%B0%E6%8D%AE%E6%B5%81%E6%B5%81%E7%A8%8B"><span class="toc-number">1.2.</span> <span class="toc-text">18.2 理解Redux单向数据流流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-3-redux%E4%BD%BF%E7%94%A8%E4%B8%89%E5%A4%A7%E5%8E%9F%E5%88%99"><span class="toc-number">1.3.</span> <span class="toc-text">18.3 redux使用三大原则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-4-redux-react-redux%E9%85%8D%E5%90%88%E4%BD%BF%E7%94%A8"><span class="toc-number">1.4.</span> <span class="toc-text">18.4 redux + react-redux配合使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#18-4-1-%E5%88%9B%E5%BB%BA%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E5%99%A8"><span class="toc-number">1.4.1.</span> <span class="toc-text">18.4.1 创建状态管理器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18-4-2-%E4%BD%BF%E7%94%A8react-redux"><span class="toc-number">1.4.2.</span> <span class="toc-text">18.4.2 使用react-redux</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-5-redux-react-redux%E5%88%86%E6%A8%A1%E5%9D%97%E4%BD%BF%E7%94%A8"><span class="toc-number">1.5.</span> <span class="toc-text">18.5 redux+react-redux分模块使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-6-redux-react-redux-%E5%88%86%E6%A8%A1%E5%9D%97-%E5%BC%82%E6%AD%A5%E6%93%8D%E4%BD%9C"><span class="toc-number">1.6.</span> <span class="toc-text">18.6 redux + react-redux + 分模块+ 异步操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#18-6-1-redux-thunk"><span class="toc-number">1.6.1.</span> <span class="toc-text">18.6.1 redux-thunk</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18-6-2-redux-saga"><span class="toc-number">1.6.2.</span> <span class="toc-text">18.6.2 redux-saga</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-7-%E4%BD%BF%E7%94%A8immutable%E4%B8%8D%E5%8F%AF%E5%8F%98%E6%95%B0%E6%8D%AE%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.7.</span> <span class="toc-text">18.7 使用immutable不可变数据数据结构</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%B9%9D%E3%80%81redux-toolkit"><span class="toc-number">2.</span> <span class="toc-text">十九、redux toolkit</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#19-1-%E4%BB%80%E4%B9%88%E6%98%AFRedux-Toolkit"><span class="toc-number">2.1.</span> <span class="toc-text">19.1 什么是Redux Toolkit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#19-2-%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8redux-toolkit"><span class="toc-number">2.2.</span> <span class="toc-text">19.2 如何使用redux-toolkit</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#19-2-1-%E5%88%9B%E5%BB%BA%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E5%99%A8"><span class="toc-number">2.2.1.</span> <span class="toc-text">19.2.1 创建状态管理器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#19-2-2-%E5%85%A5%E5%8F%A3%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E5%99%A8"><span class="toc-number">2.2.2.</span> <span class="toc-text">19.2.2 入口文件配置状态管理器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#19-2-3-%E5%88%9B%E5%BB%BA%E5%88%86%E6%A8%A1%E5%9D%97%E5%88%87%E7%89%87"><span class="toc-number">2.2.3.</span> <span class="toc-text">19.2.3 创建分模块切片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#19-2-4-%E6%95%B4%E5%90%88%E5%88%87%E7%89%87"><span class="toc-number">2.2.4.</span> <span class="toc-text">19.2.4 整合切片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#19-2-5-%E7%BB%84%E4%BB%B6%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E5%99%A8"><span class="toc-number">2.2.5.</span> <span class="toc-text">19.2.5 组件中使用状态管理器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#19-3-%E6%8F%90%E5%8F%96%E5%BC%82%E6%AD%A5%E6%93%8D%E4%BD%9C"><span class="toc-number">2.3.</span> <span class="toc-text">19.3 提取异步操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#19-3-1-%E8%87%AA%E5%B7%B1%E5%AE%9A%E4%B9%89%E8%AF%B7%E6%B1%82%E5%87%BD%E6%95%B0"><span class="toc-number">2.3.1.</span> <span class="toc-text">19.3.1 自己定义请求函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#19-3-2-%E4%BD%BF%E7%94%A8-createAsyncThunk-%E8%AF%B7%E6%B1%82%E6%95%B0%E6%8D%AE"><span class="toc-number">2.3.2.</span> <span class="toc-text">19.3.2 使用 createAsyncThunk 请求数据</span></a></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/react-study/1/" rel="bookmark" title="React学习第一天">React学习第一天</a></li><li><a href="/react-study/2/" rel="bookmark" title="React学习第二天">React学习第二天</a></li><li><a href="/react-study/3/" rel="bookmark" title="React学习第三天">React学习第三天</a></li><li><a href="/react-study/4/" rel="bookmark" title="React学习第四天">React学习第四天</a></li><li><a href="/react-study/5/" rel="bookmark" title="React学习第五天">React学习第五天</a></li><li><a href="/react-study/6/" rel="bookmark" title="React学习第六天">React学习第六天</a></li><li><a href="/react-study/7/" rel="bookmark" title="React学习第七天">React学习第七天</a></li><li class="active"><a href="/react-study/8/" rel="bookmark" title="React学习第八天">React学习第八天</a></li><li><a href="/react-study/react-router-params/" rel="bookmark" title="React路由传参的几种方式">React路由传参的几种方式</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="叶星辰" data-src="/images/avatar.jpg"><p class="name" itemprop="name">叶星辰</p><div class="description" itemprop="description">温柔正确的人总是难以生存，因为这个世界既不温柔 也不正确</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">39</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">7</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">17</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0NhMW1EMHduMQ==" title="https:&#x2F;&#x2F;github.com&#x2F;Ca1mD0wn1"><i class="ic i-github"></i></span> <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9VZmRIbw==" title="https:&#x2F;&#x2F;twitter.com&#x2F;UfdHo"><i class="ic i-twitter"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9tZW5nLXhpbmcteW91LWppLXNpLXl1ZS1odWFuZy0yNw==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;meng-xing-you-ji-si-yue-huang-27"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTUwMjkxOTQ0NQ==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;502919445"><i class="ic i-cloud-music"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20vdS83NTc4MjU1ODg1" title="https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;7578255885"><i class="ic i-weibo"></i></span> <span class="exturl item email" data-url="aHR0cHM6Ly9tYWlsLmdvb2dsZS5jb20vbWFpbC91LzAvI2luYm94" title="https:&#x2F;&#x2F;mail.google.com&#x2F;mail&#x2F;u&#x2F;0&#x2F;#inbox"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>links</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/react-study/7/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/interview/programming/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/vue3%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/" title="分类于 vue3移动端项目开发">vue3移动端项目开发</a></div><span><a href="/vue-mobile/2/" title="vue-mobile项目开发流程第二部分(单文件组件介绍)">vue-mobile项目开发流程第二部分(单文件组件介绍)</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/" title="分类于 微信小程序">微信小程序</a></div><span><a href="/wx-app/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91/" title="微信公众号的开发">微信公众号的开发</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/react%E5%AD%A6%E4%B9%A0/" title="分类于 react学习">react学习</a></div><span><a href="/react-study/5/" title="React学习第五天">React学习第五天</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/" title="分类于 微信小程序">微信小程序</a></div><span><a href="/wx-app/day1/" title="微信小程序学习第一天">微信小程序学习第一天</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/interview/" title="分类于 面试用">面试用</a></div><span><a href="/interview/wrapper-object/" title="js中包装对象">js中包装对象</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/vue3%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/" title="分类于 vue3移动端项目开发">vue3移动端项目开发</a></div><span><a href="/vue-mobile/5/" title="vue-mobile项目开发流程第五部分(封装数据请求)">vue-mobile项目开发流程第五部分(封装数据请求)</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/vue3%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/" title="分类于 vue3移动端项目开发">vue3移动端项目开发</a></div><span><a href="/vue-mobile/4/" title="vue-mobile项目开发流程第四部分(开始构建项目)">vue-mobile项目开发流程第四部分(开始构建项目)</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/" title="分类于 微信小程序">微信小程序</a></div><span><a href="/wx-app/day3/" title="构建电商界面的小程序（一）">构建电商界面的小程序（一）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/index/" title="分类于 index">index</a></div><span><a href="/Blog_introduction/Blog_introduction/" title="Welcome!">Welcome!</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/vue3%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/" title="分类于 vue3移动端项目开发">vue3移动端项目开发</a></div><span><a href="/vue-mobile/7/" title="vue-mobile项目开发流程第七部分(构建detail页面)">vue-mobile项目开发流程第七部分(构建detail页面)</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2021 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">叶星辰 @ 永不陨落的星辰</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">625k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">9:28</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"react-study/8/",favicon:{show:"星辰",hide:"你快回来"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/miku.model.json"},"display":{"position":"right","width":250,"height":500},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html><!-- rebuild by hrmmi -->